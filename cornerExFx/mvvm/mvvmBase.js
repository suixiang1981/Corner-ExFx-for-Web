var __extends=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return i(e,t)};return function(e,t){i(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();define(["require","exports","../core/dictionary","../controls/progress/progress","../core/util","../communication/contentType","../controls/messageBox/messageBox","../core/fXEvent","../core/arrayCollection","../controls/charts/charts"],function(e,t,n,S,v,i,M,r,l,V){"use strict";Object.defineProperty(t,"__esModule",{value:true});var w=function(){function e(){this.dataFields=new n.Dictionary}return e}();t.MVVMListInfo=w;var x;(function(e){e[e["composite"]=0]="composite";e[e["pie"]=1]="pie";e[e["annulus"]=2]="annulus"})(x=t.MVVMChartType||(t.MVVMChartType={}));var D=function(){function e(){this.series=[]}return e}();t.MVVMChartInfo=D;var B=function(){function e(){}return e}();t.MVVMChartSeriesInfo=B;var F;(function(e){e[e["major"]=0]="major";e[e["minor"]=1]="minor"})(F=t.MVVMChartAxisType||(t.MVVMChartAxisType={}));var L=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(w);t.MVVMTreeInfo=L;var C=function(){function e(){this.type=I.String;this.dateDataType=v.DateDataType.Date;this.controlType=P.String;this.controlPath="";this.controlWidth=NaN;this.controlHeight=NaN;this.controlLabelWidth=NaN;this.controlPercentWidth=NaN;this.controlPercentHeight=NaN;this.controlIsNewLine=false;this.dialogWidth=NaN;this.dialogHeight=NaN;this.inputEnabled=true;this.showCallButton=true}return e}();t.MVVMField=C;var I;(function(e){e["Number"]="Number";e["String"]="String";e["Text"]="Text";e["Date"]="Date";e["Boolean"]="Boolean";e["Buffer"]="Buffer"})(I=t.DatabaseDataType||(t.DatabaseDataType={}));var o=function(){function U(){}U.loadTreeInfo=function(e,t,n){this.loadInfo(e,t,n,true)};U.loadListInfo=function(e,t,n){this.loadInfo(e,t,n,false)};U.loadInfo=function(e,t,A,N){if(N===void 0){N=false}if(U.ListInfoDict.containsKey(e)){A(U.ListInfoDict.getValue(e))}else{S.Progress.show("正在加载...",-1);var n=v.Util.stringToXml(N?"<loadTreeInfo/>":"<loadListInfo/>");n.documentElement.setAttribute("name",e);t.post(v.Util.xmlToString(n),i.ContentType.TextXML,function(e){var t=v.Util.stringToXml(e);if(v.Util.getElementBooleanAttribute(t.documentElement,"return",false)){var n=N?new L:new w;var i=v.Util.getElementStringAttribute(t.documentElement,"labelField","");var r=v.Util.getElementStringAttribute(t.documentElement,"idField","");var l="";if(N){l=v.Util.getElementStringAttribute(t.documentElement,"parentField","")}n.isDESC=v.Util.getElementBooleanAttribute(t.documentElement,"isDESC",false);var o=v.Util.getElementStringAttribute(t.documentElement,"iconField","");var a=v.Util.getElementStringAttribute(t.documentElement,"colorField","");var s=v.Util.getElementStringAttribute(t.documentElement,"orderField","");var u=[];var c=v.Util.getElementChildrenNamedItem(t.documentElement,"chart");if(c!=null){if(n.chart==null){n.chart=new D}n.chart.type=x[v.Util.getElementStringAttribute(c,"type")];n.chart.show=v.Util.getElementBooleanAttribute(c,"show");n.chart.recordField=v.Util.getElementStringAttribute(c,"recordField");n.chart.valueField=v.Util.getElementStringAttribute(c,"valueField");n.chart.percentHeight=v.Util.getElementNumberAttribute(c,"percentHeight");for(var m=0;m<c.childNodes.length;m++){var d=c.childNodes.item(m);if(d.nodeType==1){var g=d;var h=new B;n.chart.series.push(h);h.axisType=F[v.Util.getElementStringAttribute(g,"axisType",F[F.major])];h.field=v.Util.getElementStringAttribute(g,"field","");h.type=V.SeriesType[v.Util.getElementStringAttribute(g,"type",V.SeriesType[V.SeriesType.line])]}}}var f=v.Util.getElementChildrenNamedItem(t.documentElement,"fields");for(var m=0;m<f.childNodes.length;m++){var b=f.childNodes.item(m);if(b.nodeType==1){var p=b;var E=new C;var T=v.Util.getElementStringAttribute(p,"name","");E.name=T;E.label=v.Util.getElementStringAttribute(p,"label","");E.isAdd=v.Util.getElementBooleanAttribute(p,"isAdd",true);E.isEdit=v.Util.getElementBooleanAttribute(p,"isEdit",true);E.isView=v.Util.getElementBooleanAttribute(p,"isView",true);E.enabled=v.Util.getElementBooleanAttribute(p,"enabled",true);E.list=v.Util.getElementStringAttribute(p,"list","");E.tree=v.Util.getElementStringAttribute(p,"tree","");if(E.isView){E.cellWidth=v.Util.getElementNumberAttribute(p,"cellWidth",200)}E.controlHeight=v.Util.getElementNumberAttribute(p,"controlHeight",30);E.controlWidth=v.Util.getElementNumberAttribute(p,"controlWidth",380);E.controlLabelWidth=v.Util.getElementNumberAttribute(p,"controlLabelWidth",80);E.controlPercentWidth=v.Util.getElementNumberAttribute(p,"controlPercentWidth",NaN);E.controlPercentHeight=v.Util.getElementNumberAttribute(p,"controlPercentHeight",NaN);E.controlIsNewLine=v.Util.getElementBooleanAttribute(p,"controlIsNewLine",false);E.type=U.stringToDataType(v.Util.getElementStringAttribute(p,"type",""));var y=v.Util.getElementStringAttribute(p,"controlType",E.type==I.Text?"text":"string");E.controlType=U.stringToMVVMControlType(y);if(E.controlType==P.TreeSelect||E.controlType==P.ListSelect){E.minLenght=v.Util.getElementNumberAttribute(p,"minLenght",0)}if(E.controlType==P.Other){E.controlPath=v.Util.getElementStringAttribute(p,"controlPath","");E.controlClass=v.Util.getElementStringAttribute(p,"controlClass","")}else if(E.controlType==P.Browse||E.controlType==P.TreeSelect){E.dialogWidth=v.Util.getElementNumberAttribute(p,"dialogWidth",300);E.dialogHeight=v.Util.getElementNumberAttribute(p,"dialogHeight",400);E.inputEnabled=v.Util.getElementBooleanAttribute(p,"inputEnabled",true)}else if(E.controlType==P.Phone){E.showCallButton=v.Util.getElementBooleanAttribute(p,"showCallButton",true)}if(E.type==I.String||E.type==I.Text){E.maxLenght=v.Util.getElementNumberAttribute(p,"maxLenght",NaN);E.minLenght=v.Util.getElementNumberAttribute(p,"minLenght",0)}else if(E.type==I.Number){E.maxValue=v.Util.getElementNumberAttribute(p,"maxValue",NaN);E.minValue=v.Util.getElementNumberAttribute(p,"minValue",NaN);E.decimals=v.Util.getElementNumberAttribute(p,"decimals",1)}else if(E.type==I.Date){E.dateDataType=v.Util.stringToDateDataType(v.Util.getElementStringAttribute(p,"dateDataType","date"))}if(E.name==r){n.idField=E}if(E.name==a){n.colorField=E}if(E.name==s){n.orderField=E}if(E.name==i){n.labelField=E}else if(E.name==l&&N){n.parentField=E}else if(E.name==o){n.iconField=E}else{n.dataFields.add(E.name,E)}}}A(n);S.Progress.hide()}else{S.Progress.hide();M.MessageBox.show("加载视图结构信息失败！","加载视图",M.MessageBoxButtons.OK,M.MessageBoxIcon.Error)}})}};U.stringToMVVMControlType=function(e){e=e.toLowerCase();switch(e){case"string":return P.String;case"number":return P.Number;case"date":return P.Date;case"file":return P.File;case"files":return P.Files;case"listselect":return P.ListSelect;case"password":return P.Password;case"text":return P.Text;case"multilinetext":return P.MultilineText;case"treeselect":return P.TreeSelect;case"browse":return P.Browse;case"phone":return P.Phone;default:return P.Other}};U.stringToDataType=function(e){e=e.toLowerCase();switch(e){case"string":return I.String;case"text":return I.Text;case"number":return I.Number;case"date":return I.Date;case"boolean":return I.Boolean;case"buffer":return I.Buffer;default:return I.String}};U.ListInfoDict=new n.Dictionary;U.TreeInfoDict=new n.Dictionary;return U}();t.MVVMInfo=o;var a=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.items=new l.ArrayCollection;return e}e.Load="Load";e.Added="Added";e.Edited="Edited";e.Deleted="Deleted";return e}(r.FXEvent);t.FxMVVMEvent=a;var P;(function(e){e["String"]="String";e["Text"]="Text";e["MultilineText"]="MultilineText";e["Date"]="Date";e["File"]="File";e["Files"]="Files";e["ListSelect"]="ListSelect";e["Number"]="Number";e["Password"]="Password";e["TreeSelect"]="TreeSelect";e["Browse"]="Browse";e["Other"]="Other";e["Phone"]="Phone"})(P=t.MVVMControlType||(t.MVVMControlType={}))});