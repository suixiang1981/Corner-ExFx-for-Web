var __extends=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a]};return i(e,t)};return function(e,t){i(e,t);function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}();define(["require","exports","../../core/displayObject","../../core/util","../listDataEditor/listDataEditor","../../mvc/treeDataView/TreeDataView","../../controls/handle/handle","../../core/fXEvent","../../controls/treeView/treeView","../mvvmBase"],function(e,t,a,n,o,d,s,c,D,m){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(r){__extends(e,r);function e(e,t,a,i){if(a===void 0){a="NULL"}if(i===void 0){i=""}var l=r.call(this)||this;l.treeItemOpenAutoSelectId="";l.handler=new s.Handle;l.treeLoadCancel=false;l.l=0;l.handler.addEventListener(s.FXMoveEvent.MoveStart,function(e){l.l=l.handler.left});l.handler.addEventListener(s.FXMoveEvent.Move,function(e){var t=e.x+l.l;if(t<100)t=100;var a=l.element.clientWidth-450;if(t>a)t=a;l.handler.left=t;l.treeDataView.width=t-2.5;l.listDataEditor.left=t+5});l.handler.addEventListener(s.FXMoveEvent.MoveEnd,function(e){});l.handler.width=5;l.handler.left=197.5;l.handler.percentHeight=100;l.handler.element.style.cursor="e-resize";n.Util.appendDisplayObject(l.element,l.handler);l.listDataEditor=new o.ListDataEditor(e);l.listDataEditor.left=202.5;l.listDataEditor.right=0;l.listDataEditor.percentHeight=100;l.listDataEditor.exportCSVFileName=t;l.treeDataView=new d.TreeDataView(e);l.treeDataView.left=0;l.treeDataView.width=197.5;l.treeDataView.percentHeight=100;l.treeDataView.loadInfoFunction=function(e){l.idField=e.idField;l.parentField=e.parentField;return e};l.treeDataView.load(a,i);n.Util.appendDisplayObject(l.element,l.listDataEditor);n.Util.appendDisplayObject(l.element,l.treeDataView);l.listDataEditor.control.addEventListener(c.FXMouseEvent.DoubleClick,function(e){if(l.listDataEditor.control.selectedItem!=null){var t=l.listDataEditor.control.getIdByItem(l.listDataEditor.control.selectedItem);if(l.treeDataView.control.selectedItem!=null){l.treeItemOpenAutoSelectId=l.treeDataView.control.getIdByItem(l.listDataEditor.control.selectedItem);if(!l.treeDataView.control.selectedItem.items.isExpand){l.treeDataView.control.selectedItem.items.addEventListener(c.FXCollectionEvent.Change,function(e){l.treeAutoSelect()});l.treeDataView.control.selectedItem.items.isExpand=true}else{l.treeAutoSelect()}}}});l.treeDataView.control.addEventListener(c.FXListEvent.Change,function(e){if(e.newItem!=null){var t=l.idField.name;var a=l.idField.type;var i="";if(a==m.DatabaseDataType.String||a==m.DatabaseDataType.Text||a==m.DatabaseDataType.Date){i="'"}var r=l.treeDataView.control.getIdByItem(e.newItem);l.treeLoadCancel=true;var n=l.parentField.name+"="+i+r+i;if(l.listDataEditor.Info==null){l.listDataEditor.loadFromInfo(l.treeDataView.Info,n)}else{l.listDataEditor.control.selectedItem=null;l.listDataEditor.loadData(0,n)}l.listDataEditor.additionalData.clear();l.listDataEditor.additionalData.add(l.parentField.name,r)}});l.listDataEditor.loadDataFunction=function(e){if(l.treeLoadCancel){l.treeLoadCancel=false}else{var t=l.treeDataView.control.selectedItem.items.isExpand;l.treeDataView.control.selectedItem.items.isExpand=false;l.treeDataView.control.selectedItem.items.removeAll();if(e.children.length>0){l.treeDataView.control.selectedItem.items.addItem(new D.TreeViewItem(""))}l.treeDataView.control.selectedItem.items.isExpand=t}return e};l.listDataEditor.addEventListener(m.FxMVVMEvent.Added,function(e){l.tree_change(e)});l.listDataEditor.addEventListener(m.FxMVVMEvent.Deleted,function(e){l.tree_change(e)});l.listDataEditor.addEventListener(m.FxMVVMEvent.Edited,function(e){l.tree_change(e)});return l}e.prototype.treeAutoSelect=function(){if(this.treeItemOpenAutoSelectId!=""){for(var e=0;e<this.treeDataView.control.selectedItem.items.count;e++){var t=this.treeDataView.control.selectedItem.items.getItemAt(e);var a=this.treeDataView.control.getIdByItem(t);if(a==this.treeItemOpenAutoSelectId){this.treeDataView.control.selectedItem=t;this.treeItemOpenAutoSelectId="";break}}}};e.prototype.tree_change=function(e){if(this.treeDataView.control.selectedItem.items.count==1){if(this.treeDataView.control.selectedItem.items.getItemAt(0).label=="..."||n.Util.isNullStringValue(this.treeDataView.control.selectedItem.items.getItemAt(0).label)){return}}if(e.type==m.FxMVVMEvent.Added){this.treeDataView.control.selectedItem.items.addItem(new D.TreeViewItem(e.item.label,e.item.icon,e.item.data))}else{var t=this.listDataEditor.control.getIdByData(e.item);for(var a=0;a<this.treeDataView.control.selectedItem.items.count;a++){var i=this.treeDataView.control.selectedItem.items.getItemAt(a);var r=this.treeDataView.control.getIdByData(i);if(t==r){if(e.type==m.FxMVVMEvent.Deleted){this.treeDataView.control.selectedItem.items.removeItemAt(a)}else{this.treeDataView.control.setItemData(e.item,i)}return}}}};return e}(a.DisplayObject);t.Explorer=i});