var __extends=this&&this.__extends||function(){var l=function(e,t){l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i]};return l(e,t)};return function(e,t){l(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","../treeView/treeView","../../core/fXEvent","../../core/util","../../core/arrayCollection","../../core/eventDispatcher","../handle/handle"],function(e,t,i,r,a,s,l,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=function(i){__extends(l,i);function l(e,t){if(e===void 0){e=false}if(t===void 0){t=false}var n=i.call(this,e)||this;n._backgroundColorFields=[];n._colorFields=[];n._fontFields=[];n.titleDiv=document.createElement("div");n._titleVisible=true;n._multiLine=false;n.itemWidth=0;n.isSetItemsWidth=false;n._titleItems=new s.ArrayCollection;n._multiLine=t;n.isDark=e;if(n.isDark){if(!l.isListViewCSSDarkLoaded){l.isListViewCSSDarkLoaded=true;Loader.loadCSS("cornerExFx/controls/listView/skins/"+a.Util.skin+"/dark/listView.css")}}else{if(!l.isListViewCSSLoaded){l.isListViewCSSLoaded=true;Loader.loadCSS("cornerExFx/controls/listView/skins/"+a.Util.skin+"/listView.css")}}n._scrollPanel.top=n.titleHeight;n._scrollPanel.isHScroll=true;n.titleDiv.style.position="absolute";n.panel.appendChild(n.titleDiv);a.Util.htmlElementToBottom(n.titleDiv);a.Util.htmlElementToBottom(n._scrollPanel.element);n.titleItems.addEventListener(r.FXCollectionEvent.Change,function(e){if(e.kind==r.CollectionEventKind.Add){var t=e.location;var i=e.items[t];if(t>0){a.Util.insertElement(i.element,e.items[t-1].element,true)}else{if(e.items.length==1){a.Util.appendElement(n.titleDiv,i.element)}else{a.Util.insertElement(i.element,e.items[1].element,false)}}a.Util.appendDisplayObject(n.titleDiv,i._handle);a.Util.htmlElementToTop(i._handle.element);if(n._scrollPanel.vScroller!=null){a.Util.htmlElementToTop(n._scrollPanel.vScroller.element)}i.addEventListener(r.FXResizeEvent.ResizeStart,function(e){});i.addEventListener(r.FXResizeEvent.Resize,function(e){n.scrollPanel.panel.style.width=n.itemWidth+"px";n.setTitleAndItems()});i.addEventListener(r.FXResizeEvent.Resized,function(e){})}else if(e.kind==r.CollectionEventKind.Remove){n.removeTitleItem(e.items[e.oldLocation])}else if(e.kind==r.CollectionEventKind.RemoveAll){for(var t=0;t<e.items.length;t++){n.removeTitleItem(e.items[t])}}n.setTitleAndItems();n.scrollPanel.panel.style.width=n.itemWidth+"px"});n._allItems.addEventListener(r.FXCollectionEvent.Change,function(e){if(e.kind==r.CollectionEventKind.Add){var t=e.items[e.location];t._setSubItems(n.titleItems);n.setListItemStyles(t);n.setItemStyles(t)}});n._scrollPanel.addEventListener(r.FXScrollEvent.Scroll,function(e){if(e.direction==r.ScrollDirection.Horizontal){var t=-e.value*n._scrollPanel.lineHeight;var i=0;n.titleDiv.style.left=t+"px";for(var l=0;l<n.titleItems.count;l++){var s=n.titleItems.getItemAt(l);i+=s.width;s._handle.left=i-3}}});n._scrollPanel.addEventListener(r.FXResizeEvent.Resize,function(e){if(e.clientHeight<e.scrollHeight){if(n._scrollPanel.vScroller!=null){a.Util.removeDislayObject(n._scrollPanel.element,n._scrollPanel.vScroller);a.Util.appendDisplayObject(n.element,n._scrollPanel.vScroller);a.Util.htmlElementToTop(n._scrollPanel.vScroller.element);if(n._scrollPanel.hScroller!=null){if(n._scrollPanel.hScroller.pageCount<n._scrollPanel.hScroller.count){var t=-n._scrollPanel.hScroller.value*n._scrollPanel.lineHeight;n.titleDiv.style.left=t+"px"}}}}if(e.clientWidth>=e.scrollWidth&&e.clientWidth>0){n.titleDiv.style.left="0px";n.setTitleAndItems();n.scrollPanel.panel.style.width=n.itemWidth+"px"}for(var i=0;i<n.titleItems.count;i++){var l=n.titleItems.getItemAt(i);l._handle.height=n.titleHeight+e.clientHeight}});setInterval(function(){for(var e=0;e<n._allItems.count;e++){n._allItems.getItemAt(e).sizeRefresh()}},100);return n}l.prototype.setItemStyle=function(e,t){if(t){e.element.className="listViewItemSelectedPanel"+(this.isDark?"Dark":"");e._listItemLabelElement.className="listItemSelectedLabel"+(this.isDark?"Dark":"")}else{e.element.className="listViewItemPanel"+(this.isDark?"Dark":"");e._listItemLabelElement.className="listItemLabel"+(this.isDark?"Dark":"")}};Object.defineProperty(l.prototype,"backgroundColorFields",{get:function(){return this._backgroundColorFields},set:function(e){this._backgroundColorFields=e},enumerable:true,configurable:true});Object.defineProperty(l.prototype,"colorFields",{get:function(){return this._colorFields},set:function(e){this._colorFields=e},enumerable:true,configurable:true});Object.defineProperty(l.prototype,"fontFields",{get:function(){return this._fontFields},set:function(e){this._fontFields=e},enumerable:true,configurable:true});l.prototype.refresh=function(){this.setTitleAndItems();this.scrollPanel.panel.style.width=this.itemWidth+"px"};l.prototype.createListItem=function(e){e=this.getAmendData(e);var t=new c(e.label,e.icon,e.data,this.isDark,this._multiLine);return t};l.prototype.setItemData=function(e,t){e=this.getAmendData(e);t.icon=e.icon;t.label=e.label;t.data=e.data;var i=t;if("_setSubItems"in t)i["_setSubItems"]();this.setListItemStyles(t);this.setItemStyles(t)};l.prototype.setItemStyles=function(e){if(this.colorsFunction!=null){e.setColors(this.colorsFunction(e))}else{var t=[];for(var i=0;i<this.colorFields.length;i++){var l=this.colorFields[i];if(l==this.labelField){t.push(e.label)}else if(l==this.iconField){t.push(e.icon)}else{var s=true;for(var n=0;n<this.dataFields.length;n++){var r=this.dataFields[n];if(r==l){t.push(e.data[n]);s=false;break}}if(s){t.push(null)}}}e.setColors(t)}if(this.backgroundColorsFunction!=null){e.setBackgroundColors(this.backgroundColorsFunction(e))}else{var t=[];for(var i=0;i<this.backgroundColorFields.length;i++){var l=this.backgroundColorFields[i];if(l==this.labelField){t.push(e.label)}else if(l==this.iconField){t.push(e.icon)}else{var s=true;for(var n=0;n<this.dataFields.length;n++){var r=this.dataFields[n];if(r==l){t.push(e.data[n]);s=false;break}}if(s){t.push(null)}}}e.setBackgroundColors(t)}if(this.fontsFunction!=null){e.setFonts(this.fontsFunction(e))}else{var o=[];for(var i=0;i<this.fontFields.length;i++){var l=this.fontFields[i];if(l==this.labelField){o.push(e.label)}else if(l==this.iconField){o.push(e.icon)}else{var s=true;for(var n=0;n<this.dataFields.length;n++){var r=this.dataFields[n];if(r==l){o.push(e.data[n]);s=false;break}}if(s){o.push(null)}}}e.setFonts(o)}};Object.defineProperty(l.prototype,"titleVisible",{get:function(){return this._titleVisible},set:function(e){this._titleVisible=e;if(this._titleVisible){this.titleDiv.style.visibility="visible";this.titleDiv.style.display="inline";this._scrollPanel.top=30;this._scrollPanel.isHScroll=true}else{this.titleDiv.style.visibility="hidden";this.titleDiv.style.display="none";this._scrollPanel.top=0;this._scrollPanel.isHScroll=false}},enumerable:true,configurable:true});l.prototype.removeTitleItem=function(e){a.Util.removeElement(e.element.parentElement,e.element);a.Util.removeElement(e._handle.element.parentElement,e._handle.element);this.setTitleAndItems();this.scrollPanel.panel.style.width=this.itemWidth+"px"};l.prototype.setTitleAndItems=function(){var e=0;for(var t=0;t<this.titleItems.count;t++){var i=this.titleItems.getItemAt(t);i.left=e;e+=i.width}for(var l=0;l<this._allItems.count;l++){var s=this._allItems.getItemAt(l);s.element.style.width=e+"px";s._setSubItems(this.titleItems);this.setListItemStyles(s);this.setItemStyles(s)}this.itemWidth=e};Object.defineProperty(l.prototype,"selectedItem",{get:function(){return this._selectedItem},set:function(e){i.prototype.selectItem.call(this,this._allItems,e)},enumerable:true,configurable:true});Object.defineProperty(l.prototype,"items",{get:function(){return this._items},enumerable:true,configurable:true});Object.defineProperty(l.prototype,"titleItems",{get:function(){return this._titleItems},enumerable:true,configurable:true});l.isListViewCSSLoaded=false;l.isListViewCSSDarkLoaded=false;return l}(i.TreeView);t.ListView=o;var h;(function(e){e[e["Default"]=0]="Default";e[e["Order"]=1]="Order";e[e["OrderDESC"]=2]="OrderDESC"})(h=t.TitleStyle||(t.TitleStyle={}));var d=function(l){__extends(e,l);function e(e,t,i){if(t===void 0){t=100}if(i===void 0){i=false}var s=l.call(this)||this;s._handle=new n.Handle;s.width0=0;s.element=document.createElement("div");s.isHandleMove=false;s.handleLeft=0;s._style=h.Default;s._label="";s.isDark=i;s.element.style.position="absolute";s.element.addEventListener("click",function(e){e.preventDefault();var t=new r.FXMouseEvent;t.type=r.FXMouseEvent.Click;t.target=s;s.dispatchEvent(t)});if(s.isDark){s.element.innerHTML=Loader.loadTXT("cornerExFx/controls/listView/skins/"+a.Util.skin+"/dark/listViewTitle.html",true)}else{s.element.innerHTML=Loader.loadTXT("cornerExFx/controls/listView/skins/"+a.Util.skin+"/listViewTitle.html",true)}s.listViewTitleOrder=a.Util.getElementByClass("listViewTitleOrder"+(s.isDark?"Dark":""),s.element);s.listViewTitleLabel=a.Util.getElementByClass("listViewTitle"+(s.isDark?"Dark":""),s.element);s.label=e;s.width=t;s._handle.width=5;s._handle.element.innerHTML=Loader.loadTXT("cornerExFx/controls/listView/skins/"+a.Util.skin+"/listViewSplitLine.html",true);s._handle.addEventListener(n.FXMoveEvent.MoveStart,function(e){s._handle.element.style.cursor="e-resize";s.isHandleMove=true;s.width0=s.width;s.handleLeft=s._handle.left;var t=new r.FXResizeEvent;t.type=r.FXResizeEvent.ResizeStart;t.target=s;s.dispatchEvent(t)});s._handle.addEventListener(n.FXMoveEvent.Move,function(e){s._handle.element.style.cursor="e-resize";s.isHandleMove=true;var t=new r.FXResizeEvent;t.type=r.FXResizeEvent.Resize;t.target=s;var i=s.handleLeft+e.x;var l=s.width0+i-s.handleLeft;if(l<15){l=15;i=l-s.width0+s.handleLeft}s._handle.left=i;t.oldClientWidth=s.width;t.clientWidth=l;s.width=l;s.dispatchEvent(t)});s._handle.addEventListener(n.FXMoveEvent.MoveEnd,function(e){s.isHandleMove=false;var t=new r.FXResizeEvent;t.type=r.FXResizeEvent.Resized;t.target=s;t.clientWidth=s.width;s.dispatchEvent(t)});s._handle.element.onmouseover=function(){s._handle.element.style.cursor="e-resize"};s._handle.element.onmouseout=function(){if(!s.isHandleMove){s._handle.element.style.cursor="default"}};return s}Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(e){this._style=e;if(this._style==h.Default){this.listViewTitleOrder.style.visibility="hidden"}else{this.listViewTitleOrder.style.visibility="visible";if(this._style==h.OrderDESC){if(this.isDark){this.listViewTitleOrder.src="cornerExFx/controls/listView/skins/"+a.Util.skin+"/dark/down.png"}else{this.listViewTitleOrder.src="cornerExFx/controls/listView/skins/"+a.Util.skin+"/down.png"}}else if(this._style==h.Order){if(this.isDark){this.listViewTitleOrder.src="cornerExFx/controls/listView/skins/"+a.Util.skin+"/dark/up.png"}else{this.listViewTitleOrder.src="cornerExFx/controls/listView/skins/"+a.Util.skin+"/up.png"}}}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"label",{get:function(){return this._label},set:function(e){this._label=e;this.listViewTitleLabel.textContent=this._label},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e;this.element.style.width=e+"px"},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(e){this._left=e;this.element.style.left=e+"px";this._handle.left=this._left+this._width-3},enumerable:true,configurable:true});return e}(l.EventDispatcher);t.TitleItem=d;var c=function(r){__extends(e,r);function e(e,t,i,l,s){if(t===void 0){t=""}if(i===void 0){i=[]}if(l===void 0){l=false}if(s===void 0){s=false}var n=r.call(this,e,t,i,l)||this;n._multiLine=true;n.subItems=[];n.titleItems=null;n.isDark=false;n.iii=0;n._multiLine=s;if(n.icon==null||n.icon==""){n.retract=n.retract}n.isDark=l;n.element.className=l?"listViewItemPanelDark":"listViewItemPanel";if(n._multiLine){n._listItemLabelElement.style.wordWrap="break-word";n._listItemLabelElement.style.wordBreak="break-all";n._listItemLabelElement.style.whiteSpace="normal";n._listItemLabelElement.style.height="auto"}return n}Object.defineProperty(e.prototype,"_height",{get:function(){var e=29;if(this._multiLine){e=this._listItemLabelElement.clientHeight;for(var t=0;t<this.subItems.length;t++){var i=this.subItems[t];if(e<i.firstElementChild.clientHeight){e=i.firstElementChild.clientHeight}}e+=2;if(e<29)e=29}else{e=29}return e},enumerable:true,configurable:true});e.prototype.sizeRefresh=function(){if(this._multiLine){var e=this._height;if(this._oldHeight!=e){this._oldHeight=e;this.element.style.height=e+"px";this._listItemLabelAndIconPanel.style.height=e+1+"px";for(var t=0;t<this.subItems.length;t++){var i=this.subItems[t];i.style.height=e+1+"px"}}}};e.prototype.setBackgroundColors=function(e){this.setStylesFun(e,"backgroundColor")};e.prototype.setFonts=function(e){this.setStylesFun(e,"font")};e.prototype.setStylesFun=function(e,t){var i="transparent";if(t=="color"){if(this.isDark){i="#FFFFFF"}else{i="#000000"}}else if(t=="backgroundColor"){i="transparent"}else{i=""}var l=false;if(e==null){l=true}else if(e.length==0){l=true}if(l){if(t=="color"){this._listItemLabelElement.style[t]=i}else if(t=="backgroundColor"){this._listItemLabelAndIconPanel.style[t]=i}else{this._listItemLabelElement.style[t]=i}for(var s=0;s<this.subItems.length;s++){this.subItems[s].style[t]=i}}else{if(e.length>0){var n=e[0];var r="";if(t=="color"||t=="backgroundColor"){r=this.stringColorToCSS(n,t=="color"?1:.5)}else{r=n}if(t=="color"){this._listItemLabelElement.style[t]=r}else if(t=="backgroundColor"){this._listItemLabelAndIconPanel.style[t]=r}else{this._listItemLabelElement.style[t]=r}if(e.length==1){for(var s=0;s<this.subItems.length;s++){this.subItems[s].style[t]=r}}else{for(var s=0;s<this.subItems.length;s++){if(e.length>s){if(t=="backgroundColor"||t=="color"){var o=this.subItems[s];if(t=="color"&&this._multiLine){o=o.firstElementChild}o.style[t]=this.stringColorToCSS(e[s+1],t=="color"?1:.5)}else{this.subItems[s].style[t]=e[s+1]}}else{this.subItems[s].style[t]=i}}}}}};e.prototype.setColors=function(e){this.setStylesFun(e,"color")};e.prototype._setSubItems=function(e){if(e===void 0){e=null}if(e==null){e=this.titleItems}else{this.titleItems=e}this._listItemLabelAndIconPanel.style.width=this.titleItems.getItemAt(0).width+"px";var t=Math.min(e.count-1,this.data.length);for(var i=this.subItems.length;i<t;i++){var l=document.createElement("div");l.style.position="absolute";if(this._multiLine){var s=document.createElement("div");s.style.wordWrap="break-word";s.style.wordBreak="break-all";s.style.whiteSpace="normal";s.style.height="auto";if(this.isDark){s.className="listItemLabelDark"}else{s.className="listItemLabel"}l.appendChild(s)}else{l.style.height="28px";if(this.isDark){l.className="listItemLabelDark"}else{l.className="listItemLabel"}}this.subItems.push(l)}for(var i=t;i<this.subItems.length;i++){a.Util.removeElement(this.element,this.subItems[i])}var n=e.getItemAt(0);var r=n.width;for(var i=0;i<t;i++){var l=this.subItems[i];var o=e.getItemAt(i+1);if(this._multiLine){l.firstChild.textContent=this.data[i];l.style.width=o.width+"px"}else{l.textContent=this.data[i];l.style.width=o.width-10+"px"}l.style.left=r+"px";r+=o.width;a.Util.appendElement(this.element,l)}};Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e;this.element.style.width=e+"px"},enumerable:true,configurable:true});return e}(i.TreeViewItem);t.ListViewItem=c});