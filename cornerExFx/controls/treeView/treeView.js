var __extends=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i]};return n(e,t)};return function(e,t){n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","../../core/arrayCollection","../../core/fXEvent","../../core/util","../listBox/listBase","../listBox/listBox"],function(e,t,i,o,l,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(s){__extends(t,s);function t(e){if(e===void 0){e=false}var i=s.call(this,e)||this;i.isDark=false;i._selectedItem=null;i._items=null;i.itemOpeningListenerId=-1;i.itemOpenListenerId=-1;i.itemCloseListenerId=-1;i.isDark=e;if(i.isDark){if(!t.isCSSDarkLoaded){t.isCSSDarkLoaded=true;Loader.loadCSS("cornerExFx/controls/treeView/skins/"+l.Util.skin+"/dark/treeView.css")}}else{if(!t.isCSSLoaded){t.isCSSLoaded=true;Loader.loadCSS("cornerExFx/controls/treeView/skins/"+l.Util.skin+"/treeView.css")}}i._items=new m(i._allItems,null);i.setItems(i._allItems);i.addEventListener(o.FXTreeEvent.ItemOpening,function(e){var t=e.target;if(t.count==1){if(t.getItemAt(0).label=="..."){if(i.loadItemsFunciont!=null){i.loadItemsFunciont(i.getIdByItem(t.host),function(e,t){i.loadTreeItemsCallback(e,t)})}else if(i.loadItemsByXmlDataProviderFunciont!=null){i.loadItemsByXmlDataProviderFunciont(i.getIdByItem(t.host),function(e,t){i.loadTreeItemsByXmlDataProviderCallback(e,t)})}}}});return i}t.prototype.getTreeItemById=function(e,t){if(t===void 0){t=null}if(t==null)t=this.items;var i=this.getItemById(e,t);if(i==null){for(var n=0;n<t.count;n++){var s=this.getItemById(e,t.getItemAt(n).items);if(s!=null)return s}return null}else{return i}};t.prototype.loadTreeItemsCallback=function(e,t){var i=this.getTreeItemById(e);if(i!=null){this.setTreeItemsByData(t,i.items);i.items.isExpand=false;i.items.isExpand=true}};t.prototype.loadTreeItemsByXmlDataProviderCallback=function(e,t){var i=this.getTreeItemById(e);if(i!=null){this.setTreeItemsByXmlDataProvider(t,i.items);i.items.isExpand=false;i.items.isExpand=true}};t.prototype.setTreeItemsByData=function(e,t){this.setItemsData(e,t);for(var i=0;i<e.length;i++){var n=e[i];var s=this.getItemById(this.getIdByData(n),t);this.setTreeItemsByData(n.items,s.items)}};t.prototype.setTreeItemsByXmlDataProvider=function(e,t){this.setItemsXmlDataProvider(e,t);var i=0;for(var n=0;n<e.childNodes.length;n++){var s=e.childNodes.item(n);if(s.nodeType==1){var r=s;if(i<t.count){this.setTreeItemsByXmlDataProvider(r,t.getItemAt(i).items)}i++}}if(i==0){t.removeAll()}};Object.defineProperty(t.prototype,"xmlDataProvider",{set:function(e){this._xmlDataProviderElement=e;this.setTreeItemsByXmlDataProvider(e,this.items);this.items.isExpand=true},enumerable:true,configurable:true});t.prototype.createListItem=function(e){e=this.getAmendData(e);return new a(e.label,e.icon,e.data,this.isDark)};Object.defineProperty(t.prototype,"selectedItem",{get:function(){return this._selectedItem},set:function(e){s.prototype.selectItem.call(this,this._allItems,e)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"items",{get:function(){return this._items},enumerable:true,configurable:true});t.prototype.selectItem=function(e,t){var i=new o.FXListEvent;i.oldItem=this._selectedItem;s.prototype.selectItem.call(this,e,t);if(e.contains(t)){if(this._selectedItem!=t){i.newItem=t;i.target=this;i.type=o.FXListEvent.Change;this.dispatchEvent(i)}}};t.prototype.setItems=function(e){var n=this;s.prototype.setItems.call(this,e);e.addEventListener(o.FXCollectionEvent.Change,function(e){if(e.kind==o.CollectionEventKind.Add){var t=e.location;var i=e.items[t];n.setListItemStyles(i);n.itemOpeningListenerId=i.items.addEventListener(o.FXTreeEvent.ItemOpening,function(e){n.dispatchEvent(e)});n.itemOpenListenerId=i.items.addEventListener(o.FXTreeEvent.ItemOpen,function(e){n.dispatchEvent(e)});n.itemCloseListenerId=i.items.addEventListener(o.FXTreeEvent.ItemClose,function(e){n.dispatchEvent(e)})}})};t.prototype.removeItemHandler=function(e){s.prototype.removeItemHandler.call(this,e);e.items.removeEventListener(o.FXTreeEvent.ItemOpening,this.itemOpeningListenerId);e.items.removeEventListener(o.FXTreeEvent.ItemOpen,this.itemOpenListenerId);e.items.removeEventListener(o.FXTreeEvent.ItemClose,this.itemCloseListenerId)};t.isCSSLoaded=false;t.isCSSDarkLoaded=false;return t}(s.ListBox);t.TreeView=r;var a=function(r){__extends(e,r);function e(e,t,i,n){if(t===void 0){t=""}if(i===void 0){i=[]}if(n===void 0){n=false}var s=r.call(this,e,t,i,n)||this;s._retract=0;s._items=new m(null,s);s.element.className=n?"listItemPanelDark":"listItemPanel";s.element.style.height="0px";s.listItemDisclosureIcon=l.Util.getElementByClass("listItemDisclosureIcon",s.element);s.label=e;s.icon=t;s.data=i;s.items.addEventListener(o.FXCollectionEvent.Change,function(e){if(e.location>=0){if(s.listItemDisclosureIcon.style.visibility!="visible"){s.listItemDisclosureIcon.style.visibility="visible";s.retract=s._retract}}else{if(s.listItemDisclosureIcon.style.visibility=="visible"){s.listItemDisclosureIcon.style.visibility="hidden";s.retract=s._retract}}if(e.kind==o.CollectionEventKind.Remove){s.removeItemHandler(e.items[e.oldLocation])}else if(e.kind==o.CollectionEventKind.RemoveAll){for(var t=0;t<e.items.length;t++){s.removeItemHandler(e.items[t])}}});s.items.addEventListener(o.FXTreeEvent.ItemOpen,function(e){if(e.item.items.count>0){e.item.listItemDisclosureIcon.src="cornerExFx/controls/treeView/skins/"+l.Util.skin+(n?"/dark":"")+"/open.png"}});s.items.addEventListener(o.FXTreeEvent.ItemClose,function(e){if(e.item.items.count>0){e.item.listItemDisclosureIcon.src="cornerExFx/controls/treeView/skins/"+l.Util.skin+(n?"/dark":"")+"/close.png"}});s.element.ondblclick=function(e){var t=new o.FXMouseEvent;t.x=e.x;t.y=e.y;t.button=e.button;t.target=s;t.type=o.FXMouseEvent.DoubleClick;s.dispatchEvent(t)};s.listItemDisclosureIcon.onpointerdown=function(e){var t=new o.FXMouseEvent;t.x=e.x;t.y=e.y;t.button=e.button;t.target=s;t.type=o.FXMouseEvent.MouseDown;s.dispatchEvent(t);if(s.items.count>0){s.items.isExpand=!s.items.isExpand}};s.listItemDisclosureIcon.ondblclick=function(e){e.cancelBubble=true};return s}Object.defineProperty(e.prototype,"retract",{get:function(){return this._retract},set:function(e){if(e==null){e=0}this._retract=e;var t=this._retract;if(this.listItemDisclosureIcon!=null){this.listItemDisclosureIcon.style.left=t+"px"}t+=30;this._listItemIconElement.style.left=t+"px";if(this._icon!=""&&this._icon!=null&&this._icon!=undefined){t+=30}this._listItemLabelElement.style.left=t+"px"},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:true,configurable:true});e.prototype.loadHtml=function(){this.element.innerHTML=Loader.loadTXT("cornerExFx/controls/treeView/skins/"+l.Util.skin+(this.isDark?"/dark":"")+"/treeViewItem.html",true)};e.prototype.removeItemHandler=function(e){e.items.removeAllEventListener(o.FXCollectionEvent.Change);e.items.removeAllEventListener(o.FXTreeEvent.ItemOpening);e.items.removeAllEventListener(o.FXTreeEvent.ItemOpen);e.items.removeAllEventListener(o.FXTreeEvent.ItemClose)};Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"icon",{get:function(){return this._icon},set:function(e){this._listItemIconElement.src=e;var t=l.Util.isNullStringValue(e);var i=l.Util.isNullStringValue(this._icon);this._listItemIconElement.style.display=t?"none":"inline";this._listItemIconElement.style.visibility=t?"hidden":"visible";if(t&&!i||!t&&i){this._icon=e;this.retract=this._retract}else{this._icon=e}},enumerable:true,configurable:true});return e}(s.ListBoxItem);t.TreeViewItem=a;var m=function(i){__extends(e,i);function e(e,t){var s=i.call(this)||this;s._allItems=null;s._host=null;s._isExpand=false;s._allItems=e;s._host=t;i.prototype.addEventListener.call(s,o.FXCollectionEvent.Change,function(e){if(e.kind==o.CollectionEventKind.Add){var t=e.items[e.location];if(s._host==null){var i=s._allItems;i.addItem(t)}else{if(s.isExpand){if(e.location==0){var i=s._allItems;i.addItem(t)}else if(e.location>0){var n=s._allItems.getItemIndex(s._items[e.location-1]);var i=s._allItems;i.addItemAt(t,n+1)}}}s.setAddedItem(t)}else if(e.kind==o.CollectionEventKind.Remove){s.removeItemHandler(e.items[e.oldLocation])}else if(e.kind==o.CollectionEventKind.RemoveAll){for(var n=0;n<e.items.length;n++){s.removeItemHandler(e.items[n])}}});return s}e.prototype.removeItemHandler=function(e){this._allItems.removeItem(e)};e.prototype.setAddedItem=function(e){var t=e;t._parent=this._host;if(t.parent!=null){t.retract=t.parent.retract+t.parent._height}if(t.items._allItems==null){t.items._allItems=this._allItems;t.items.setExpand();for(var i=0;i<t.items.count;i++){this.setAddedItem(t.items.getItemAt(i))}t.addEventListener(o.FXMouseEvent.DoubleClick,function(e){t.items.isExpand=!t.items.isExpand})}};Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"isExpand",{get:function(){return this._isExpand},set:function(e){if(this._isExpand!=e){if(e){var t=new o.FXTreeEvent;t.item=this._host;t.target=this;t.type=o.FXTreeEvent.ItemOpening;this.dispatchEvent(t);if(t.cancel){return}}this._isExpand=e;this.setExpand();var i=new o.FXTreeEvent;i.item=this._host;i.target=this;i.type=e?o.FXTreeEvent.ItemOpen:o.FXTreeEvent.ItemClose;this.dispatchEvent(i)}},enumerable:true,configurable:true});e.prototype.setExpand=function(){if(this._isExpand){var e=this._allItems.getItemIndex(this._host);for(var t=0;t<this._items.length;t++){this._allItems.addItemAt(this._items[t],e+1+t)}for(var t=0;t<this._items.length;t++){var i=this._items[t];if(i.items.count>0){if(i.items._isExpand){i.items._isExpand=false;i.items.isExpand=true}}}}else{this.removeAllExpandedItems(this._items)}};e.prototype.removeAllExpandedItems=function(e){for(var t=0;t<e.length;t++){var i=e[t];this._allItems.removeItem(i);if(i.items.count>0){this.removeAllExpandedItems(i.items._items)}}};return e}(i.ArrayCollection);t.ItemCollection=m;var c=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.items=[];return e}return e}(n.ListItemData);t.TreeItemData=c});