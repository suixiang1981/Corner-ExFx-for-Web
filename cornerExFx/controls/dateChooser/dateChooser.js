var __extends=this&&this.__extends||function(){var r=function(e,t){r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();define(["require","exports","../../core/displayObject","../../core/util","../../core/fXEvent","../fields/numberField","../fields/fieldBase","../../core/nongLi"],function(e,t,n,h,r,f,m,S){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=function(l){__extends(u,l);function u(e){if(e===void 0){e=false}var t=l.call(this)||this;t.isShowTimeEditor=false;t.buttonDate=[];t.date=[];t._selectDate=null;t._year=(new Date).getFullYear();t._month=(new Date).getMonth()+1;t._hours=(new Date).getHours()+1;t._minutes=(new Date).getMinutes()+1;t.isShowTimeEditor=e;t.element.style.width=t.width+"px";t.element.style.height=t.height+"px";if(!u.isCSSLoaded){u.isCSSLoaded=true;Loader.loadCSS("cornerExFx/controls/dateChooser/skins/"+h.Util.skin+"/dateChooser.css")}t.element.innerHTML=Loader.loadTXT("cornerExFx/controls/dateChooser/skins/"+h.Util.skin+"/dateChooser.html",true);if(e){if(t.hNumber==null){t.hNumber=new f.NumberField;t.hNumber.minValue=0;t.hNumber.maxValue=23;t.hNumber.stepSize=1;t.hNumber.decimals=0;t.hNumber.bottom=5;t.hNumber.left=5;t.hNumber.labelWidth=0;t.hNumber.width=107.5;h.Util.appendDisplayObject(t.element,t.hNumber)}if(t.mNumber==null){t.mNumber=new f.NumberField;t.mNumber.minValue=0;t.mNumber.maxValue=59;t.mNumber.stepSize=1;t.mNumber.decimals=0;t.mNumber.bottom=5;t.mNumber.left=112.5;t.mNumber.labelWidth=10;t.mNumber.width=117.5;t.mNumber.label=":";t.mNumber.addEventListener(m.FxFieldEvent.Change,function(e){t.dEvent()});t.hNumber.addEventListener(m.FxFieldEvent.Change,function(e){t.dEvent()});h.Util.appendDisplayObject(t.element,t.mNumber)}}t.today=h.Util.getElementById("dataChooserToolButtonToday",t.element);t.labelM=h.Util.getElementByClass("dataChooserMonth",t.element);t.labelY=h.Util.getElementByClass("dataChooserYear",t.element);for(var n=1;n<=42;n++){var r=h.Util.getElementById("dataChooserButton"+n,t.element);t.buttonDate.push(r);t.date.push(null)}var a=h.Util.getElementById("dataChooserToolButtonYL",t.element);var o=h.Util.getElementById("dataChooserToolButtonYR",t.element);var i=h.Util.getElementById("dataChooserToolButtonML",t.element);var s=h.Util.getElementById("dataChooserToolButtonMR",t.element);a.addEventListener("pointerdown",function(e){e.stopPropagation()});o.addEventListener("pointerdown",function(e){e.stopPropagation()});i.addEventListener("pointerdown",function(e){e.stopPropagation()});s.addEventListener("pointerdown",function(e){e.stopPropagation()});t.today.addEventListener("pointerdown",function(e){e.stopPropagation()});a.onclick=function(){t.year=t._year-1};o.onclick=function(){t.year=t._year+1};i.onclick=function(){var e=t._month-1;if(e<1){t.month=12;t.year=t._year-1}else{t.month=e}};s.onclick=function(){var e=t._month+1;if(e>12){t.month=1;t.year=t._year+1}else{t.month=e}};t.selectedDate=new Date;t.today.onclick=function(){t.selectedDate=new Date;t.dEvent()};return t}Object.defineProperty(u.prototype,"width",{get:function(){return 240},enumerable:true,configurable:true});Object.defineProperty(u.prototype,"height",{get:function(){if(this.isShowTimeEditor){return 310}else{return 270}},enumerable:true,configurable:true});u.prototype.dEvent=function(){if(this.isShowTimeEditor){this.hNumber.verify();this.mNumber.verify();this._selectDate.setHours(this.hNumber.value);this._selectDate.setMinutes(this.mNumber.value)}var e=new r.FXCalendarLayoutChangeEvent;e.target=this;e.type=r.FXCalendarLayoutChangeEvent.Change;e.newDate=this.selectedDate;this.dispatchEvent(e)};Object.defineProperty(u.prototype,"selectedDate",{get:function(){return this._selectDate},set:function(e){this._selectDate=e;var t=this._selectDate;if(t==null){t=new Date}this._year=t.getFullYear();this._month=t.getMonth()+1;this.setYM();this._hours=t.getHours();this._minutes=t.getMinutes();this.setHM()},enumerable:true,configurable:true});u.prototype.getNewDay=function(e,t){var n=Math.abs(e.getTime())+t*24*60*60*1e3;var r=new Date(n);var a=new Date(0);return r};u.prototype.isEqualDay=function(e,t){if(e==null||t==null){return}return e.getDate()==t.getDate()&&e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()};Object.defineProperty(u.prototype,"year",{set:function(e){this._year=e;this.setYM()},enumerable:true,configurable:true});Object.defineProperty(u.prototype,"month",{set:function(e){this._month=e;this.setYM()},enumerable:true,configurable:true});Object.defineProperty(u.prototype,"hours",{set:function(e){this._hours=e;this.setHM()},enumerable:true,configurable:true});Object.defineProperty(u.prototype,"minutes",{set:function(e){this._minutes=e;this.setHM()},enumerable:true,configurable:true});u.prototype.setHM=function(){if(this.hNumber!=null)this.hNumber.value=this._hours;if(this.mNumber!=null)this.mNumber.value=this._minutes};u.prototype.setYM=function(){var r=this;this.labelY.textContent=this._year.toString();this.labelM.textContent=this._month.toString();var e=new Date(this._year,this._month-1,1);var t=e.getDay();if(t==0){t=7}e=this.getNewDay(e,-t);for(var n=0;n<42;n++){e=this.getNewDay(e,1);var a=this.buttonDate[n];var o=e.getMonth()+1;var i=e.getDate();var s=S.NongLi.solar2lunar(e.getFullYear(),o,i);var l="";if(s!=null){var u=s["isLeap"];var h=s["lDay"];var f=s["lMonth"];var m=false;var d=false;var c=false;var p=false;var b=false;var v=false;var y=false;var g=false;var D=false;var N=false;var _=false;var w=false;var C=false;if(o==1&&i==1){c=true}else if(o==3&&i==8){p=true}else if(o==5&&i==1){b=true}else if(o==5&&i==4){y=true}else if(o==6&&i==1){v=true}else if(o==10&&i==1){g=true}else if(o==12&&i==25){w=true}else if(f==5&&h==5){D=true}else if(f==8&&h==15){N=true}else if(f==9&&h==9){_=true}else if(f==1&&h==15){C=true}else if(!u){if(h==1&&f==1){d=true}else if(f==12&&(h==29||h==30)){var E=this.getNewDay(e,1);var M=S.NongLi.solar2lunar(E.getFullYear(),E.getMonth()+1,E.getDate());if(M["lMonth"]==1&&M["lDay"]==1){m=true}}}if(c){l="元旦"}else if(p){l="妇女节"}else if(b){l="劳动节"}else if(y){l="青年节"}else if(v){l="儿童节"}else if(g){l="国庆节"}else if(D){l="端午节"}else if(N){l="中秋节"}else if(_){l="重阳节"}else if(C){l="元宵节"}else if(w){l="圣诞节"}else if(d){l="春节"}else if(m){l="除夕"}else if(s["isTerm"]){l=s["Term"]}else{if(h==1){l=s["IMonthCn"]}else{l=s["IDayCn"]}}}var L="<p class='dataChooserNumber'>"+e.getDate().toString()+"</p><p class='dataChooserNongLi'>"+l+"</p>";if(this.tagFunction!=null){var B=this.tagFunction(e);if(B!=null&&B!=""){L+="<p class='dataChooserTag' style='background-color: "+B+"'></p>"}}a.innerHTML=L;this.date[n]=e;if(e.getMonth()+1==this._month){var F=new Date;if(this.isEqualDay(this._selectDate,e)){a.className="dataChooserButtonSelected"}else if(this.isEqualDay(F,e)){a.className="dataChooserButtonNow"}else{a.className="dataChooserButton"}}else{a.className="dataChooserButtonB"}a.addEventListener("pointerdown",function(e){e.stopPropagation()});a.onclick=function(e){for(var t=0;t<r.buttonDate.length;t++){var n=r.buttonDate[t];if(n==e.target){r.selectedDate=r.date[t];r.dEvent();break}}}}};u.isCSSLoaded=false;return u}(n.DisplayObject);t.DateChooser=a});