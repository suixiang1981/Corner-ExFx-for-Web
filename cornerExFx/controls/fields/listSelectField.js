var __extends=this&&this.__extends||function(){var l=function(t,e){l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return l(t,e)};return function(t,e){l(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();define(["require","exports","./comboFieldBase","../listBox/listBox","../listBox/listBase","../../core/util","../../core/fXEvent","./fieldBase"],function(t,e,i,l,n,o,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:true});var u=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e._listBox=new l.ListBox;e._maxLenght=Number.MAX_VALUE;e._minLenght=0;e.input.style.pointerEvents="none";e.listBox.left=0;e.listBox.top=0;e.listBox.scrollPanel.isHScroll=false;e.addEventListener(s.FxDropdownEvent.Open,function(t){e.openHandler();if(e.loadItemsFunciont!=null){e.loadItemsFunciont(function(t){e.loadItemsFunction(t)});t.cancel=true}if(e.loadItemsByXmlDataProviderFunciont!=null){e.loadItemsByXmlDataProviderFunciont(function(t){e.loadItemsByXmlDataProviderFunction(t)});t.cancel=true}});e.listBox.addEventListener(s.FXListEvent.Change,function(t){if(e.listBox.selectedItem!=null){e.value=new n.ListItemData(e.listBox.selectedItem.label,e.listBox.selectedItem.icon,e.listBox.selectedItem.data)}});return e}Object.defineProperty(e.prototype,"minLenght",{get:function(){return this._minLenght},set:function(t){this._minLenght=t},enumerable:true,configurable:true});e.prototype.verify=function(){if(this.input.value.length<this._minLenght){this.verified=false;this.input.title="必须选择一项。"}else{this.verified=true;this.input.title=""}};Object.defineProperty(e.prototype,"listBox",{get:function(){return this._listBox},enumerable:true,configurable:true});e.prototype.loadItemsFunction=function(t){for(var e=0;e<t.length;e++){this.listBox.addItemByData(t[e],this.listBox.items)}if(this._value!=null){this.valueString=String(this.listBox.getIdByData(this._value))}else{this.valueString=""}this.listBox.selectItemById(this.valueString);this.openHandler()};e.prototype.loadItemsByXmlDataProviderFunction=function(t){var e=[];for(var i=0;i<t.childNodes.length;i++){var l=t.childNodes.item(i);if(l.nodeType==1){var n=l;e.push(this.listBox.xmlDataProviderToListItemData(n))}}this.loadItemsFunction(e)};e.prototype.loadItemCallback=function(t){this.value=t};e.prototype.loadItemByXmlDataProviderCallback=function(t){var e=this.listBox.xmlDataProviderToListItemData(t);this.loadItemCallback(e)};Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){if(this._value!=t){var e=this._value;this._value=t;this.setInputValue();this.setXMLValue();var i=new a.FxFieldEvent;i.target=this;i.type=a.FxFieldEvent.Change;i.oldValue=e;i.newValue=t;this.dispatchEvent(i)}},enumerable:true,configurable:true});e.prototype.setInputValue=function(){if(this.value==null){this.input.value=""}else{this.input.value=this.value.label;if(this.value.icon==""||this.value.icon==null){this.input.style.left="0px";this.comboFieldIcon.src="";this.comboFieldIcon.style.visibility="hidden"}else{this.input.style.left="30px";this.comboFieldIcon.src=this.value.icon;this.comboFieldIcon.style.visibility="visible"}}};e.prototype.setXMLValue=function(){if(this._dataElement!=null){if(this._value!=null){if(!this.valueIsNULL()){this.valueString=String(this.listBox.getIdByData(this._value))}}else{this.valueString=""}o.Util.setElementStringAttribute(this._dataElement,this._field,this.valueString)}};e.prototype.valueIsNULL=function(){if(this._value==null)return true;if(this._value.label==""||this._value.label==null){if(this._value.data==null)return true;if(this._value.data.length==0)return true}return false};Object.defineProperty(e.prototype,"xmlDataProvider",{get:function(){return this._dataElement},set:function(t){var e=this;this._dataElement=t;this.valueString=o.Util.getElementStringAttribute(this._dataElement,this._field,"");if(!o.Util.isNullStringValue(this.valueString)){if(this.loadItemFunciont!=null){this.loadItemFunciont(this.valueString,function(t){e.loadItemCallback(t)})}if(this.loadItemByXmlDataProviderFunciont!=null){this.loadItemByXmlDataProviderFunciont(this.valueString,function(t){e.loadItemByXmlDataProviderCallback(t)})}}else{this.value=null;this.setInputValue()}},enumerable:true,configurable:true});e.prototype.openHandler=function(){o.Util.appendDisplayObject(this.popupPanel,this.listBox);this.popupWidth=this.element.clientWidth-this.labelWidth-8;this.listBox.width=this.popupWidth;var t=this.listBox.items.count*30;if(t>200)t=200;this.popupHeight=t;this.listBox.height=this.popupHeight;this.listBox.visible=true};return e}(i.ComboFieldBase);e.ListSelectField=u});