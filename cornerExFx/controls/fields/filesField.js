var __extends=this&&this.__extends||function(){var l=function(e,t){l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i]};return l(e,t)};return function(e,t){l(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","./fieldBase","../../core/util","../../core/fXEvent","../../core/arrayCollection","./FileField"],function(e,t,i,r,s,l,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=function(e){__extends(i,e);function i(){var t=e.call(this)||this;t.fileFieldCollection=new l.ArrayCollection;t._postHost="";t._postPort=null;t.timer=-1;t.oldH=0;t._value="";t._enabled=true;t._maxSize=10485760;if(!i.isFilesFieldCSSLoaded){i.isFilesFieldCSSLoaded=true;Loader.loadCSS("cornerExFx/controls/fields/skins/"+r.Util.skin+"/filesField.css")}t.addButtonDiv=r.Util.getElementByClass("filesFieldAddButton",t.element);t.fileFieldCollection.addEventListener(s.FXCollectionEvent.Change,function(e){t.setFields()});t.addButtonDiv.onclick=function(){t.addField()};t.addField();t.value=t._value;return t}Object.defineProperty(i.prototype,"postHost",{get:function(){return this._postHost},set:function(e){this._postHost=e;for(var t=0;t<this.fileFieldCollection.count;t++){var i=this.fileFieldCollection.getItemAt(t);i.postHost=e}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"postPort",{get:function(){return this._postPort},set:function(e){this._postPort=e;for(var t=0;t<this.fileFieldCollection.count;t++){var i=this.fileFieldCollection.getItemAt(t);i.postPort=e}},enumerable:true,configurable:true});i.prototype.addField=function(){var l=this;var o=new n.FileField;o.addEventListener(n.FxFileFieldEvent.Download,function(e){e.target=l;l.dispatchEvent(e)});o.addEventListener(n.FxFileFieldEvent.Uploading,function(e){e.target=l;l.dispatchEvent(e)});o.postHost=this._postHost;o.postPort=this._postPort;o.labelWidth=0;o.label="";o.value="";this.fileFieldCollection.addItem(o);o.addEventListener(n.FxFileFieldEvent.Upload,function(e){e.target=l;l.dispatchEvent(e);if(l.fileFieldCollection.count>1){if(r.Util.isNullStringValue(o.value)){r.Util.removeDislayObject(l.element,o);o.removeAllEventListener(n.FxFileFieldEvent.Upload);o.removeAllEventListener(n.FxFileFieldEvent.Uploading);o.removeAllEventListener(n.FxFileFieldEvent.Download);o.removeAllEventListener(n.FxFileFieldEvent.Error);l.fileFieldCollection.removeItem(o)}}var t=[];for(var i=0;i<l.fileFieldCollection.count;i++){o=l.fileFieldCollection.getItemAt(i);t.push(o.value)}l.value=t.join(";");e.target=l;l.dispatchEvent(e)});o.addEventListener(n.FxFileFieldEvent.Error,function(e){e.target=l;l.dispatchEvent(e)})};Object.defineProperty(i.prototype,"labelWidth",{set:function(e){this._labelWidth=e;this.labelDiv.style.width=e+"px";this.setFields()},enumerable:true,configurable:true});i.prototype.setFields=function(){var n=this;if(this.timer==-1){this.timer=setTimeout(function(){n.timer=-1;if(n.fileFieldCollection!=null){var e=0;for(var t=0;t<n.fileFieldCollection.count;t++){var i=n.fileFieldCollection.getItemAt(t);i._showClear=n.fileFieldCollection.count>1;i.enabled=i.enabled;i.left=n._labelWidth;i.maxSize=n._maxSize;i.right=0;i.top=e;r.Util.appendDisplayObject(n.element,i);e+=5+i.height}var l=0;if(n._enabled){l=e+30;n.addButtonDiv.style.right=2+"px";n.addButtonDiv.style.top=e+"px";n.addButtonDiv.style.visibility="visible"}else{l=e;n.addButtonDiv.style.visibility="hidden"}if(n.oldH!=l){var o=new s.FXResizeEvent;o.type=s.FXResizeEvent.Resize;o.target=n;o.clientHeight=l;o.clientWidth=n.width;o.scrollHeight=l;o.scrollWidth=n.width;o.oldClientHeight=n.oldH;o.oldClientWidth=n.width;o.oldScrollHeight=n.oldH;o.oldScrollWidth=n.width;n.oldH=l;n.height=l;n.dispatchEvent(o)}}},1)}};i.prototype.loadHTML=function(){this.element.innerHTML=Loader.loadTXT("cornerExFx/controls/fields/skins/"+r.Util.skin+"/filesField.html",true)};Object.defineProperty(i.prototype,"value",{get:function(){return this._value},set:function(e){if(this._value!=e){this._value=e;var t=this._value.split(";");var i=this.fileFieldCollection.count;for(var l=i;l<t.length;l++){this.addField()}i=this.fileFieldCollection.count;for(var l=i;l<t.length;l++){this.fileFieldCollection.removeItemAt(0)}for(var l=0;l<this.fileFieldCollection.count;l++){this.fileFieldCollection.getItemAt(l).value=t[l]}this.setInputValue();this.setXMLValue()}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e;for(var t=0;t<this.fileFieldCollection.count;t++){var i=this.fileFieldCollection.getItemAt(t);i.enabled=this._enabled}if(this._enabled){this.labelDiv.style.color="#000000"}else{this.labelDiv.style.color="#666666"}this.setFields()},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"maxSize",{get:function(){return this._maxSize},set:function(e){this._maxSize=e;for(var t=0;t<this.fileFieldCollection.count;t++){var i=this.fileFieldCollection.getItemAt(t);i.maxSize=this._maxSize}},enumerable:true,configurable:true});i.prototype.valueStringToValue=function(){this.value=this.valueString};i.prototype.valueToValueString=function(){this.valueString=this.value};i.isFilesFieldCSSLoaded=false;return i}(i.FieldBase);t.FilesField=o});