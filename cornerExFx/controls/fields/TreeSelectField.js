var __extends=this&&this.__extends||function(){var a=function(t,e){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return a(t,e)};return function(t,e){a(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();define(["require","exports","./browseFieldBase","../listBox/listBase","../treeView/treeView","../../core/util"],function(t,e,i,a,l,n){"use strict";Object.defineProperty(e,"__esModule",{value:true});var s=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.treeView=new l.TreeView;t.pathField="path";t.path=[];t.loadPathI=0;t._minLenght=0;t.input.style.pointerEvents="none";t.treeView.left=0;t.treeView.top=0;t.treeView.right=0;t.treeView.bottom=0;return t}t.prototype.loadItemCallback=function(t){this.value=t};t.prototype.loadItemByXmlDataProviderCallback=function(t){var e=this.treeView.xmlDataProviderToListItemData(t);this.loadItemCallback(e)};t.prototype.loadItemsCallback=function(t,e){this.treeView.setTreeItemsByData(e,this.loadPathIItems);this.loadPathIItems.isExpand=false;this.loadPathIItems.isExpand=true;this.loadItemsByPathI()};t.prototype.loadItemsByXmlDataProviderCallback=function(t,e){this.treeView.setTreeItemsByXmlDataProvider(e,this.loadPathIItems);this.loadPathIItems.isExpand=false;this.loadPathIItems.isExpand=true;this.loadItemsByPathI()};Object.defineProperty(t.prototype,"xmlDataProvider",{get:function(){return this._dataElement},set:function(t){var e=this;this._dataElement=t;this.valueString=n.Util.getElementStringAttribute(t,this._field,"");if(this.loadItemFunciont!=null){this.loadItemFunciont(this.valueString,function(t){e.loadItemCallback(t)})}if(this.loadItemByXmlDataProviderFunciont!=null){this.loadItemByXmlDataProviderFunciont(this.valueString,function(t){e.loadItemByXmlDataProviderCallback(t)})}},enumerable:true,configurable:true});t.prototype.openHandler=function(){var e=this;n.Util.appendDisplayObject(this.innerPanel,this.treeView);if(this.path.length==0){if(this.loadItemPathFunciont!=null){this.loadItemPathFunciont(this.valueString,function(t){e.loadItemsByPath(t)})}}if(this.loadItemPathByXmlDataProviderFunciont!=null){this.loadItemPathByXmlDataProviderFunciont(this.valueString,function(t){e.loadItemsByPath(n.Util.getElementStringAttribute(t,e.pathField,""))})}this.okButton.onclick};t.prototype.loadItemsByPath=function(t){t.replace("\\","/");this.path=t.split("/");this.loadPathI=0;this.loadPathIItems=this.treeView.items;this.loadItemsByPathI()};t.prototype.loadItemsByPathI=function(){var i=this;if(this.loadPathI<this.path.length){var t=this.path[this.loadPathI];for(var e=0;e<this.loadPathIItems.count;e++){var a=this.loadPathIItems.getItemAt(e);if(this.treeView.getIdByItem(a)==t){if(this.loadPathI==this.path.length-1){this.treeView.selectedItem=a}else{this.loadPathI++;this.loadPathIItems=a.items;a.items.isExpand=false;a.items.isExpand=true;this.loadItemsByPathI()}return}}var l="";if(this.loadPathI>0){l=this.path[this.loadPathI-1]}if(this.loadItemsFunciont!=null){this.loadItemsFunciont(l,function(t,e){i.loadItemsCallback(t,e)})}if(this.loadItemsByXmlDataProviderFunciont!=null){this.loadItemsByXmlDataProviderFunciont(l,function(t,e){i.loadItemsByXmlDataProviderCallback(t,e)})}}else{}};Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){if(this._value!=t){this._value=t;this.setInputValue();this.setXMLValue()}},enumerable:true,configurable:true});t.prototype.setInputValue=function(){if(this.value==null){this.input.value=""}else{this.input.value=this.value.label}this.path=[]};t.prototype.setXMLValue=function(){if(this._dataElement!=null){if(this._value!=null){this.valueString=String(this.treeView.getIdByData(this._value))}else{this.valueString=""}n.Util.setElementStringAttribute(this._dataElement,this._field,this.valueString)}};t.prototype.selectedHandler=function(){var t=this.treeView.selectedItem;if(t==null){this.value=null}else{this.value=new a.ListItemData(t.label,t.icon,t.data);this.path.push(this.treeView.getIdByItem(t));while(t.parent!=null){t=t.parent;this.path.push(this.treeView.getIdByItem(t))}this.path.reverse()}};Object.defineProperty(t.prototype,"minLenght",{get:function(){return this._minLenght},set:function(t){this._minLenght=t},enumerable:true,configurable:true});t.prototype.verify=function(){if(this.input.value.length<this._minLenght){this.verified=false;this.input.title="必须选择一项。"}else{this.verified=true;this.input.title=""}};return t}(i.BrowseFieldBase);e.TreeSelectField=s});