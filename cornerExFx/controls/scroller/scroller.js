var __extends=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i]};return n(e,t)};return function(e,t){n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","../../core/displayObject","../handle/handle","../../core/util","../../core/fXEvent"],function(e,t,i,s,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(n){__extends(e,n);function e(e){if(e===void 0){e=true}var i=n.call(this)||this;i.handle=new s.Handle;i._timerHandle=-1;i.p0=0;i.isVertical=true;i.isHCSSLoaded=false;i.isVCSSLoaded=false;i._count=-1;i._pageCount=-1;i._value=0;i.isVertical=e;var t=i.isVertical?"vScroller":"hScroller";if(!i.isVCSSLoaded&&e||!i.isHCSSLoaded&&!e){Loader.loadCSS("cornerExFx/controls/scroller/skins/"+o.Util.skin+"/"+t+".css");if(e){i.isVCSSLoaded=true}else{i.isHCSSLoaded=true}}i._element.innerHTML=Loader.loadTXT("cornerExFx/controls/scroller/skins/"+o.Util.skin+"/"+t+".html",true);i.bodyDIV=o.Util.getElementByClass("scrollerBody",i._element);i.upDIV=o.Util.getElementByClass(i.isVertical?"vScrollerUp":"hScrollerUp",i._element);i.downDIV=o.Util.getElementByClass(i.isVertical?"vScrollerDown":"hScrollerDown",i._element);i.handleDIV=o.Util.getElementByClass(i.isVertical?"vScrollerHandle":"hScrollerHandle",i._element);o.Util.appendDisplayObject(i._element,i.handle);setTimeout(function(){i.refresh()},1);i.handle.addEventListener(s.FXMoveEvent.MoveStart,function(e){i.p0=i.isVertical?i.handleDIV.offsetTop:i.handleDIV.offsetLeft});i.handle.addEventListener(s.FXMoveEvent.Move,function(e){var t=0;if(i.isVertical){t=e.y+i.p0;if(t<i.upDIV.offsetHeight)t=i.upDIV.offsetHeight;if(t>i.downDIV.offsetTop-i.handleDIV.offsetHeight)t=i.downDIV.offsetTop-i.handleDIV.offsetHeight}else{t=e.x+i.p0;if(t<i.upDIV.offsetWidth)t=i.upDIV.offsetWidth;if(t>i.downDIV.offsetLeft-i.handleDIV.offsetWidth)t=i.downDIV.offsetLeft-i.handleDIV.offsetWidth}i.handlerToValue(t);i.dispatchScrollEvent()});i.downDIV.onpointerup=function(){i.clearTimer()};i.upDIV.onpointerup=function(){i.clearTimer()};document.addEventListener("pointerup",function(){i.clearTimer()});i.downDIV.onpointerdown=function(e){e.cancelBubble=true;i.upOrDown(false)};i.upDIV.onpointerdown=function(e){e.cancelBubble=true;i.upOrDown()};i.bodyDIV.onpointerdown=function(e){if(i.isVertical){var t=e.offsetY;if(t<i.handleDIV.offsetTop){i.handlerToValue(t)}else{i.handlerToValue(t-i.handleDIV.offsetHeight)}}else{var t=e.offsetX;if(t<i.handleDIV.offsetLeft){i.handlerToValue(t)}else{i.handlerToValue(t-i.handleDIV.offsetWidth)}}i.dispatchScrollEvent()};document.body.addEventListener("pointerup",function(){i.clearTimer()});i.value=i._value;return i}e.prototype.upOrDown=function(e){var t=this;if(e===void 0){e=true}this.clearTimer();this._timerHandle=setTimeout(function(){e?t.up():t.down();clearTimeout(t._timerHandle);t._timerHandle=setInterval(function(){e?t.up():t.down()},60)},300);e?this.up():this.down()};e.prototype.handlerToValue=function(e){if(this.isVertical){this.value=(e-this.upDIV.offsetHeight)*(this._count-this._pageCount)/(this.element.offsetHeight-this.upDIV.offsetHeight-this.upDIV.offsetHeight-this.handleDIV.offsetHeight)}else{this.value=(e-this.upDIV.offsetWidth)*(this._count-this._pageCount)/(this.element.offsetWidth-this.upDIV.offsetWidth-this.upDIV.offsetWidth-this.handleDIV.offsetWidth)}};e.prototype.clearTimer=function(){if(this._timerHandle!=-1){clearInterval(this._timerHandle);this._timerHandle=-1}};e.prototype.down=function(){if(this.value<this.count-this.pageCount){this.value++;this.dispatchScrollEvent()}else{this.clearTimer()}};e.prototype.up=function(){if(this.value>0){this.value--;this.dispatchScrollEvent()}else{this.clearTimer()}};Object.defineProperty(e.prototype,"count",{get:function(){return this._count},set:function(e){if(this._count!=e){this._count=e;this.value=this._value;this.refresh()}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"pageCount",{get:function(){return this._pageCount},set:function(e){if(this._pageCount!=e){this._pageCount=e;this.value=this._value;this.refresh()}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){if(e<0)e=0;var t=this._count-this._pageCount;if(t<0)t=0;if(e>t)e=t;if(this._value!=e){this._value=e;this.dispatchScrollEvent()}this.refresh()},enumerable:true,configurable:true});e.prototype.refresh=function(){var e=this;if(this._pageCount<this._count){this.element.style.visibility="visible";this.element.style.display="inline"}else{if(this._value!=0){this._value=0}this.element.style.visibility="hidden";this.element.style.display="none"}if(this._pageCount<this._count){if(this.element.clientHeight==0&&this.element.clientWidth==0){setTimeout(function(){e.refresh()},1);return}else{if(this.isVertical){var t=(this.element.clientHeight-this.upDIV.offsetHeight-this.downDIV.offsetHeight)*this._pageCount/this._count;if(t<this.upDIV.offsetHeight)t=this.upDIV.offsetHeight;this.handleDIV.style.height=t+1+"px";this.handleDIV.style.top=this.upDIV.offsetHeight+(this.element.offsetHeight-this.upDIV.offsetHeight-this.upDIV.offsetHeight-t)*this._value/(this._count-this._pageCount)+"px"}else{var t=(this.element.clientWidth-this.upDIV.offsetWidth-this.downDIV.offsetWidth)*this._pageCount/this._count;if(t<this.upDIV.offsetWidth)t=this.upDIV.offsetWidth;this.handleDIV.style.width=t+1+"px";this.handleDIV.style.left=this.upDIV.offsetWidth+(this.element.offsetWidth-this.upDIV.offsetWidth-this.upDIV.offsetWidth-t)*this._value/(this._count-this._pageCount)+"px"}}}if(this.isVertical){this.handle.left=0;this.handle.top=this.handleDIV.offsetTop;this.handle.percentWidth=100;this.handle.height=this.handleDIV.offsetHeight}else{this.handle.top=0;this.handle.left=this.handleDIV.offsetLeft;this.handle.percentHeight=100;this.handle.width=this.handleDIV.offsetWidth}};e.prototype.dispatchScrollEvent=function(){var e=new l.FXScrollEvent;e.target=this;e.type=l.FXScrollEvent.Scroll;e.value=this._value;e.direction=this.isVertical?l.ScrollDirection.Vertical:l.ScrollDirection.Horizontal;this.dispatchEvent(e)};return e}(i.DisplayObject);t.Scroller=n});