var __extends=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)if(t.hasOwnProperty(l))e[l]=t[l]};return n(e,t)};return function(e,t){n(e,t);function l(){this.constructor=e}e.prototype=t===null?Object.create(t):(l.prototype=t.prototype,new l)}}();define(["require","exports","./listBase","../../core/fXEvent","../../core/arrayCollection","../../core/util","../../containers/scrollPanel/scrollPanel","../../core/eventDispatcher"],function(e,t,l,r,s,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(n){__extends(i,n);function i(e,t){if(e===void 0){e=false}if(t===void 0){t=true}var l=n.call(this)||this;l._backgroundColorField="";l._colorField="";l._fontField="";l._selectedItem=null;l._items=new s.ArrayCollection;l.isDark=e;if(l.isDark){if(!i.isListCSSDarkLoaded){i.isListCSSDarkLoaded=true;Loader.loadCSS("cornerExFx/controls/listBox/skins/"+a.Util.skin+"/dark/listBox.css")}}else{if(!i.isListCSSLoaded){i.isListCSSLoaded=true;Loader.loadCSS("cornerExFx/controls/listBox/skins/"+a.Util.skin+"/listBox.css")}}l._allItems=l.items;l.setItems(l.items);l._scrollPanel=new o.ScrollPanel(e);l.itemsPanel=l._scrollPanel.panel;l.loadHtml();l.panel=a.Util.getElementByClass("listBaseBody",l.element);l.titleHeight=a.Util.getElementNumberAttribute(l.panel,"titleHeight",30);l.element.style.overflow="hidden";l._scrollPanel.left=0;l._scrollPanel.right=0;l._scrollPanel.top=0;l._scrollPanel.bottom=0;a.Util.appendDisplayObject(l.panel,l._scrollPanel);l.panel.tabIndex=0;l.panel.onclick=function(e){var t=new r.FXMouseEvent;t.x=e.x;t.y=e.y;t.button=e.button;t.target=l;t.type=r.FXMouseEvent.Click;l.dispatchEvent(t)};l.panel.ondblclick=function(e){var t=new r.FXMouseEvent;t.x=e.x;t.y=e.y;t.button=e.button;t.target=l;t.type=r.FXMouseEvent.DoubleClick;l.dispatchEvent(t)};l.panel.onkeydown=function(e){if(l._selectedItem!=null){var t=l._allItems.getItemIndex(l._selectedItem);if(t>=0){if(e.keyCode==40){if(t<l._allItems.count-1){l.selectedItem=l._allItems.getItemAt(t+1)}}else if(e.keyCode==38){if(t>0){l.selectedItem=l._allItems.getItemAt(t-1)}}else if(e.keyCode==39){if("items"in l.selectedItem){l.selectedItem["items"].isExpand=true}}else if(e.keyCode==37){if("items"in l.selectedItem){l.selectedItem["items"].isExpand=false}}}}};return l}Object.defineProperty(i.prototype,"backgroundColorField",{get:function(){return this._backgroundColorField},set:function(e){this._backgroundColorField=e},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"colorField",{get:function(){return this._colorField},set:function(e){this._colorField=e},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"fontField",{get:function(){return this._fontField},set:function(e){this._fontField=e},enumerable:true,configurable:true});i.prototype.setListItemStyles=function(e){if(this.colorFunction!=null){e.setColor(this.colorFunction(e))}else{var t=null;var l=this.colorField;if(l==this.labelField){t=e.label}else if(l==this.iconField){t=e.icon}else{for(var n=0;n<this.dataFields.length;n++){var i=this.dataFields[n];if(i==l){t=e.data[n];break}}}e.setColor(t)}if(this.backgroundColorFunction!=null){e.setBackgroundColor(this.backgroundColorFunction(e))}else{var t=null;var l=this.backgroundColorField;if(l==this.labelField){t=e.label}else if(l==this.iconField){t=e.icon}else{for(var n=0;n<this.dataFields.length;n++){var i=this.dataFields[n];if(i==l){t=e.data[n];break}}}e.setBackgroundColor(t)}if(this.fontFunction!=null){e.setFont(this.fontFunction(e))}else{var s=null;var l=this.fontField;if(l==this.labelField){s=e.label}else if(l==this.iconField){s=e.icon}else{for(var n=0;n<this.dataFields.length;n++){var i=this.dataFields[n];if(i==l){s=e.data[n];break}}}e.setFont(s)}};i.prototype.setItemData=function(e,t){e=this.getAmendData(e);t.icon=e.icon;t.label=e.label;t.data=e.data;if("_setSubItems"in t)t["_setSubItems"]();this.setListItemStyles(t)};Object.defineProperty(i.prototype,"scrollPanel",{get:function(){return this._scrollPanel},enumerable:true,configurable:true});i.prototype.selectItem=function(e,t){var l=this;if(this._selectedItem!=t){var n=new r.FXListEvent;n.type=r.FXListEvent.Change;n.target=this;n.oldItem=this._selectedItem;if(e.contains(t)){this._selectedItem=t;setTimeout(function(){if(l._selectedItem!=null){if(l._selectedItem.element.offsetTop-l._scrollPanel.panel.parentElement.scrollTop<0){l._scrollPanel.panel.parentElement.scrollTop=l._selectedItem.element.offsetTop}else if(l._selectedItem.element.offsetTop-l._scrollPanel.panel.parentElement.scrollTop+l._selectedItem.element.offsetHeight>l._scrollPanel.panel.parentElement.clientHeight){l._scrollPanel.panel.parentElement.scrollTop=l._selectedItem.element.offsetTop+l._selectedItem.element.offsetHeight-l._scrollPanel.panel.parentElement.clientHeight}}},200)}else{this._selectedItem=null}n.newItem=this._selectedItem;this.dispatchEvent(n)}this.element.focus();for(var i=0;i<e.count;i++){var s=e.getItemAt(i);this.setItemStyle(s,s==this._selectedItem)}};i.prototype.createListItem=function(e){e=this.getAmendData(e);return new c(e.label,e.icon,e.data,this.isDark)};Object.defineProperty(i.prototype,"xmlDataProvider",{set:function(e){this._xmlDataProviderElement=e;this.setItemsXmlDataProvider(this._xmlDataProviderElement,this.items)},enumerable:true,configurable:true});i.prototype.selectItemById=function(e){this.selectedItem=this.getItemById(e)};Object.defineProperty(i.prototype,"selectedItem",{get:function(){return this._selectedItem},set:function(e){this.selectItem(this._allItems,e)},enumerable:true,configurable:true});i.prototype.selectItemFun=function(e,t){var l=new r.FXListEvent;l.oldItem=this._selectedItem;if(e.contains(t)){if(this._selectedItem!=t){l.newItem=t;l.target=this;l.type=r.FXListEvent.Change;this.selectItemFun(e,t);this.dispatchEvent(l)}}};Object.defineProperty(i.prototype,"items",{get:function(){return this._items},enumerable:true,configurable:true});i.prototype.loadHtml=function(){if(this.isDark){this.element.innerHTML=Loader.loadTXT("cornerExFx/controls/listBox/skins/"+a.Util.skin+"/dark/listBase.html",true)}else{this.element.innerHTML=Loader.loadTXT("cornerExFx/controls/listBox/skins/"+a.Util.skin+"/listBase.html",true)}};i.prototype.setItemStyle=function(e,t){if(t){e.element.className="listItemSelectedPanel"+(this.isDark?"Dark":"");e._listItemLabelElement.className="listItemSelectedLabel"+(this.isDark?"Dark":"")}else{e.element.className="listItemPanel"+(this.isDark?"Dark":"");e._listItemLabelElement.className="listItemLabel"+(this.isDark?"Dark":"")}};i.prototype.setItems=function(e){n.prototype.setItems.call(this,e);e.addEventListener(r.FXCollectionEvent.Change,function(e){if(e.kind==r.CollectionEventKind.Add){var t=e.location;var l=e.items[t];var n=false;if("parent"in l){if(l["parent"]==null){n=true}}else{n=true}if(n){l.element.style.height=l._height+"px"}}})};i.prototype.removeItemHandler=function(e){n.prototype.removeItemHandler.call(this,e);e.element.style.height="0px"};i.prototype.changeHandler=function(){while(this.addItemArray.length>0){var e=this.addItemArray.shift();e.element.style.height=e._height+"px"}};i.isListCSSLoaded=false;i.isListCSSDarkLoaded=false;return i}(l.ListBase);t.ListBox=i;var c=function(o){__extends(e,o);function e(e,t,l,n){if(t===void 0){t=""}if(l===void 0){l=[]}if(n===void 0){n=false}var i=o.call(this)||this;i._oldHeight=-1;i.isDark=false;i.element=document.createElement("div");i._label="";i._icon="";i._data=[];i.isDark=n;var s="";if(i.isDark){s="Dark"}i.loadHtml();i._listItemLabelAndIconPanel=a.Util.getElementByClass("listItemLabelAndIconPanel",i.element);i._listItemLabelElement=a.Util.getElementByClass("listItemLabel"+s,i.element);i._listItemLabelElement.style.right="0px";i.element.className="listItemPanel"+s;i._listItemIconElement=a.Util.getElementByClass("listItemIcon",i.element);i.label=e;i.icon=t;i.data=l;i.element.onpointerdown=function(e){var t=new r.FXMouseEvent;t.x=e.x;t.y=e.y;t.button=e.button;t.target=i;t.type=r.FXMouseEvent.MouseDown;i.dispatchEvent(t)};return i}e.prototype.stringColorToCSS=function(e,t){if(t===void 0){t=.5}if(e==""||e==null){return""}e=e.replace("0x","");e=e.replace("0X","");e=e.replace("#","");if(e.length==6){return"rgba("+parseInt("0x"+e.substr(0,2))+","+parseInt("0x"+e.substr(2,2))+","+parseInt("0x"+e.substr(4,2))+","+t+")"}};Object.defineProperty(e.prototype,"_height",{get:function(){return 30},enumerable:true,configurable:true});e.prototype.loadHtml=function(){this.element.innerHTML=Loader.loadTXT("cornerExFx/controls/listBox/skins/"+a.Util.skin+(this.isDark?"/dark":"")+"/listBoxItem.html",true)};Object.defineProperty(e.prototype,"label",{get:function(){return this._label},set:function(e){this._label=e;this._oldHeight=-1;this._listItemLabelElement.textContent=this._label},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"icon",{get:function(){return this._icon},set:function(e){this._icon=e;this._listItemIconElement.src=e;var t=a.Util.isNullStringValue(e);this._listItemIconElement.style.display=t?"none":"inline";this._listItemIconElement.style.visibility=t?"hidden":"visible";this._listItemLabelElement.style.left=t?"0px":"30px"},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e;this._oldHeight=-1},enumerable:true,configurable:true});e.prototype.setBackgroundColor=function(e){this.setStyleFun(e,"backgroundColor")};e.prototype.setFont=function(e){this.setStyleFun(e,"font")};e.prototype.setStyleFun=function(e,t){var l="transparent";if(t=="color"){if(this.isDark){l="#FFFFFF"}else{l="#000000"}}else if(t=="backgroundColor"){l="transparent"}else{l=""}var n=false;if(e==null){n=true}else if(e==""){n=true}if(n){if(t=="color"){this._listItemLabelElement.style[t]=l}else if(t=="backgroundColor"){this._listItemLabelAndIconPanel.style[t]=l}else{this._listItemLabelElement.style[t]=l}}else{var i="";if(t=="color"||t=="backgroundColor"){i=this.stringColorToCSS(e,t=="color"?1:.5)}if(t=="color"){this._listItemLabelElement.style[t]=i}else if(t=="backgroundColor"){this._listItemLabelAndIconPanel.style[t]=i}else{this._listItemLabelElement.style[t]=e}}};e.prototype.setColor=function(e){this.setStyleFun(e,"color")};return e}(n.EventDispatcher);t.ListBoxItem=c;var u;(function(e){e[e["Change"]=0]="Change"})(u||(u={}))});