var __extends=this&&this.__extends||function(){var r=function(e,t){r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i]};return r(e,t)};return function(e,t){r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","./eChartsBase","../../core/util"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e._xAxis=[new n];e._yAxis=[new n];e._series=[];e._object=new Object;e.timeHandler=-1;e._yAxis[0].type=g.value;return e}Object.defineProperty(e.prototype,"xmlDataProvider",{get:function(){return this._dataElement},set:function(e){this._dataElement=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},set:function(e){this._xAxis=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},set:function(e){this._yAxis=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"series",{get:function(){return this._series},set:function(e){this._series=e},enumerable:true,configurable:true});e.prototype.draw=function(){var e=this;if(this.timeHandler==-1){this.timeHandler=setTimeout(function(){e.timeHandler=-1;e.drawExec()},100)}};e.prototype.drawExec=function(){if(this._object["xAxis"]==null)this._object["xAxis"]=[];if(this._object["yAxis"]==null)this._object["yAxis"]=[];if(this._object["series"]==null)this._object["series"]=[];if(this._object["tooltip"]==null){this._object["tooltip"]={trigger:"item"}}var e=this._object["xAxis"];for(var t=0;t<this.xAxis.length;t++){var i=this.xAxis[t];var r=void 0;if(e.length>t){r=e[t]}else{r=new Object;e.push(r)}if(i==null){r["show"]=false}else{r["name"]=i.label;r["type"]=g[i.type];r["show"]=true;if(i.field!=null&&i.field!=""){r["data"]=this.getData(i.field)}}}for(var t=this.xAxis.length;t<e.length;t++){e[t]["show"]=false}e=this._object["yAxis"];for(var t=0;t<this.yAxis.length;t++){var i=this.yAxis[t];var r=void 0;if(e.length>t){r=e[t]}else{r=new Object;e.push(r)}if(i==null){r["show"]=false}else{r["name"]=i.label;r["type"]=g[i.type];r["show"]=true;if(i.field!=null&&i.field!=""){r["data"]=this.getData(i.field)}}}for(var t=this.yAxis.length;t<e.length;t++){e[t]["show"]=false}var n=this._object["series"];for(var t=0;t<this.series.length;t++){var s=this.series[t];var u=void 0;if(n.length>t){u=n[t]}else{u=new Object;n.push(u)}u["name"]=s.label;u["type"]=x[s.type];if(s.field!=null&&s.field!=""){if(s.type==x.pie||s.type==x.annulus){if(s.type==x.annulus){u["type"]="pie";var o=s;u["radius"]=[o.insideRadius*100+"%",o.outsideRadius*100+"%"]}else{u["radius"]=[0,"75%"]}var a=s;var l=this.getData(a.nameField);var f=[];if(a.field!="[Count]"){f=this.getData(a.field)}var c=[];var p=[];if(l!=null){for(var h=0;h<l.length;h++){var y=l[h];var d=c.indexOf(y);if(d<0){c.push(y);if(f.length>h){p.push(Number(f[h]))}else{p.push(1)}}else{if(f.length>h){p[d]+=Number(f[h])}else{p[d]+=1}}}var b=[];for(var h=0;h<c.length;h++){var _=new Object;_["name"]=c[h];_["value"]=p[h];b.push(_)}u["data"]=b}this._object["tooltip"]["formatter"]="{a} <br/>{b} : {c} ({d}%)"}else if(s.type==x.area||s.type==x.bar||s.type==x.line){this._object["tooltip"]["formatter"]="{a} <br/>{b} : {c} ";u["data"]=this.getData(s.field);u["yAxisIndex"]=s.yAxisIndex;if(s.type==x.area){u["type"]="line"}if(s.type==x.area){u["itemStyle"]={normal:{areaStyle:{type:"default",opacity:"1"}}}}else{u["itemStyle"]={normal:{areaStyle:{type:"default",opacity:"0"}}}}}}}for(var t=this.series.length;t<n.length;t++){var u=n[t];u["data"]=null}this.setOption(this._object)};e.prototype.getData=function(e){var t=[];if(this._dataElement!=null){for(var i=0;i<this._dataElement.childNodes.length;i++){var r=this._dataElement.childNodes.item(i);if(r.nodeType==1){var n=r;t.push(s.Util.getElementStringAttribute(n,e))}}}return t};return e}(i.EChartBase);t.Charts=r;var n=function(){function e(){this._label="";this._field="";this._show=true;this._scale=true;this._type=g.category;this._min=null;this._max=null;this._logBase=10}Object.defineProperty(e.prototype,"label",{get:function(){return this._label},set:function(e){this._label=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"field",{get:function(){return this._field},set:function(e){this._field=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"show",{get:function(){return this._show},set:function(e){this._show=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"min",{get:function(){return this._min},set:function(e){this._min=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"max",{get:function(){return this._max},set:function(e){this._max=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"logBase",{get:function(){return this._logBase},set:function(e){this._logBase=e},enumerable:true,configurable:true});return e}();t.Axis=n;var g;(function(e){e[e["value"]=0]="value";e[e["category"]=1]="category";e[e["time"]=2]="time";e[e["log"]=3]="log"})(g=t.AxisType||(t.AxisType={}));var u=function(){function e(){this._type=x.line;this._label="";this._field="";this._yAxisIndex=0;this._xAxisIndex=0}Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"label",{get:function(){return this._label},set:function(e){this._label=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"field",{get:function(){return this._field},set:function(e){this._field=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"yAxisIndex",{get:function(){return this._yAxisIndex},set:function(e){this._yAxisIndex=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xAxisIndex",{get:function(){return this._xAxisIndex},set:function(e){this._xAxisIndex=e},enumerable:true,configurable:true});return e}();t.Series=u;var x;(function(e){e[e["line"]=0]="line";e[e["bar"]=1]="bar";e[e["pie"]=2]="pie";e[e["annulus"]=3]="annulus";e[e["area"]=4]="area"})(x=t.SeriesType||(t.SeriesType={}));var o=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e._nameField="";e.__type=x.pie;return e}Object.defineProperty(e.prototype,"nameField",{get:function(){return this._nameField},set:function(e){this._nameField=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"type",{get:function(){return this.__type},enumerable:true,configurable:true});return e}(u);t.PieSeries=o;var a=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e._insideRadius=.5;e._outsideRadius=.7;e.__type=x.annulus;return e}Object.defineProperty(e.prototype,"insideRadius",{get:function(){return this._insideRadius},set:function(e){this._insideRadius=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"outsideRadius",{get:function(){return this._outsideRadius},set:function(e){this._outsideRadius=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"type",{get:function(){return this.__type},enumerable:true,configurable:true});return e}(o);t.AnnulusSeries=a});