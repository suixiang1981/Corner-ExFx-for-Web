var __extends=this&&this.__extends||function(){var o=function(e,t){o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return o(e,t)};return function(e,t){o(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();define(["require","exports","../../controls/treeView/treeView","../../core/util","../../mvvm/mvvmBase","../../controls/progress/progress","../../communication/contentType","../../controls/messageBox/messageBox","../listDataBox/listDataBox","../../core/fXEvent"],function(e,t,r,a,l,m,i,c,n,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=function(o){__extends(e,o);function e(e,t,n){if(t===void 0){t=null}if(n===void 0){n=false}var s=o.call(this,e,t,n)||this;s.treeDataName="";s.openingItem=null;s.treeParent="NULL";s.treeDataName=e;s._control=new r.TreeView(n);s._control.percentWidth=100;s._control.percentHeight=100;a.Util.appendDisplayObject(s.element,s._control);s._control.addEventListener(u.FXTreeEvent.ItemOpening,function(e){if(e.item.items.count==1){if(a.Util.isNullStringValue(s._control.getIdByItem(e.item.items.getItemAt(0)))){m.Progress.show("正在加载...",-1);s.openingItem=e.item;var t=s._control.getIdByItem(e.item);var n=a.Util.stringToXml("<loadTree/>");n.documentElement.setAttribute("name",s.treeDataName);n.documentElement.setAttribute("parent",t);n.documentElement.setAttribute("where",s.where);s.httpClient.post(a.Util.xmlToString(n),i.ContentType.TextXML,function(e){var t=a.Util.stringToXml(e);if(a.Util.getElementBooleanAttribute(t.documentElement,"return",false)){var n=a.Util.getElementChildrenNamedItem(t.documentElement,"data");s._control.setTreeItemsByXmlDataProvider(n,s.openingItem.items);for(var o=0;o<s.openingItem.items.count;o++){var r=s.openingItem.items.getItemAt(o)}var i=new l.FxMVVMEvent;i.type=l.FxMVVMEvent.Load;i.xml=t;i.target=s;i.items=s.openingItem.items;m.Progress.hide();s.dispatchEvent(i)}else{m.Progress.hide();c.MessageBox.show("加载数据失败！","加载数据",c.MessageBoxButtons.OK,c.MessageBoxIcon.Error)}})}}});return s}Object.defineProperty(e.prototype,"Info",{get:function(){return this._info},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"control",{get:function(){return this._control},enumerable:true,configurable:true});e.prototype.load=function(e,t){var n=this;if(e===void 0){e="NULL"}if(t===void 0){t=""}this.where=t;this.treeParent=e;l.MVVMInfo.loadTreeInfo(this.treeDataName,this.httpClient,function(e){n._info=e;n.loadFromInfo(e,n.where)})};e.prototype.loadData=function(){var r=this;m.Progress.show("正在加载...",-1);var e=a.Util.stringToXml("<loadTree/>");e.documentElement.setAttribute("name",this.treeDataName);e.documentElement.setAttribute("parent",this.treeParent);e.documentElement.setAttribute("where",this.where);this.httpClient.post(a.Util.xmlToString(e),i.ContentType.TextXML,function(e){var t=a.Util.stringToXml(e);if(a.Util.getElementBooleanAttribute(t.documentElement,"return",false)){var n=a.Util.getElementChildrenNamedItem(t.documentElement,"data");r.control.xmlDataProvider=n;var o=new l.FxMVVMEvent;o.type=l.FxMVVMEvent.Load;o.target=r;o.items=r.control.items;o.xml=t;m.Progress.hide();r.dispatchEvent(o)}else{m.Progress.hide();c.MessageBox.show("加载数据失败！","加载数据",c.MessageBoxButtons.OK,c.MessageBoxIcon.Error)}})};return e}(n.ListDataBox);t.TreeDataView=o});