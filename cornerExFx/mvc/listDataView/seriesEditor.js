var __extends=this&&this.__extends||function(){var l=function(e,t){l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i]};return l(e,t)};return function(e,t){l(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","../../core/displayObject","../../core/util","../../controls/fields/listSelectField","../../controls/listBox/listBox","../../mvvm/mvvmBase","../../core/fXEvent","../../controls/fields/fieldBase","../../controls/charts/charts"],function(e,t,i,a,d,f,n,o,r,p){"use strict";Object.defineProperty(t,"__esModule",{value:true});var l=function(l){__extends(s,l);function s(e,t){var i=l.call(this)||this;i.setFieldListCancel=false;i.oldType="---";i.oldField=null;i.list=t;i.info=e;i.list.addEventListener(o.FXCollectionEvent.Change,function(e){var t=i.list.getItemIndex(i);if(t==0){i.axisTypeField.visible=false;i.height=70}i.setFieldList()});i.element.className="seriesEditor";if(!s.isCSSLoaded){s.isCSSLoaded=true;Loader.loadCSS("cornerExFx/mvc/listDataView/skins/"+a.Util.skin+"/seriesEditor.css")}i.field=new d.ListSelectField;i.field.addEventListener(r.FxFieldEvent.Change,function(e){if(i.field.listBox.selectedItem!=null){i.oldField=i.field.listBox.selectedItem.data[0].name}i.setLatterFieldList();if(i.onChange!=null){i.onChange()}});i.field.right=5;i.field.top=5;i.field.left=0;i.field.height=30;i.field.label="系列字段";a.Util.appendDisplayObject(i.element,i.field);i.typeField=new d.ListSelectField;i.typeField.addEventListener(r.FxFieldEvent.Change,function(e){i.setFieldList();if(i.onChange!=null){i.onChange()}});i.typeField.right=5;i.typeField.top=40;i.typeField.left=0;i.typeField.height=30;i.typeField.label="系列类型";a.Util.appendDisplayObject(i.element,i.typeField);i.typeField.listBox.iconField="icon";i.typeField.listBox.items.addItem(new f.ListBoxItem("折线图","cornerExFx/mvc/listDataView/skins/lineCharts.png",[p.SeriesType.line]));i.typeField.listBox.items.addItem(new f.ListBoxItem("面积图","cornerExFx/mvc/listDataView/skins/areaCharts.png",[p.SeriesType.area]));i.typeField.listBox.items.addItem(new f.ListBoxItem("柱状图","cornerExFx/mvc/listDataView/skins/barCharts.png",[p.SeriesType.bar]));i.typeField.listBox.selectedItem=i.typeField.listBox.items.getItemAt(0);i.axisTypeField=new d.ListSelectField;i.axisTypeField.addEventListener(r.FxFieldEvent.Change,function(e){i.setFieldList();if(i.onChange!=null){i.onChange()}});i.axisTypeField.right=5;i.axisTypeField.top=75;i.axisTypeField.left=0;i.axisTypeField.height=30;i.axisTypeField.label="纵(Y)轴位置";a.Util.appendDisplayObject(i.element,i.axisTypeField);i.axisTypeField.listBox.iconField="icon";i.axisTypeField.listBox.items.addItem(new f.ListBoxItem("主轴(左侧)","cornerExFx/mvc/listDataView/skins/yLeft.png",[n.MVVMChartAxisType.major]));i.axisTypeField.listBox.items.addItem(new f.ListBoxItem("辅轴(右侧)","cornerExFx/mvc/listDataView/skins/yRight.png",[n.MVVMChartAxisType.minor]));i.axisTypeField.listBox.selectedItem=i.axisTypeField.listBox.items.getItemAt(0);i.height=105;i.percentWidth=100;return i}s.prototype.setFieldList=function(){if(this.setFieldListCancel)return;this.setFieldListCancel=true;if(this.axisTypeField!=null&&this.field!=null){var e=this.axisTypeField.listBox.selectedItem==this.axisTypeField.listBox.items.getItemAt(0);var t=this.list.getItemIndex(this);var i=null;for(var l=0;l<t;l++){var s=this.list.getItemAt(l);if(e){if(l==0||s.axisTypeField.listBox.selectedItem.data[0]==s.axisTypeField.listBox.items.getItemAt(0)){if(s.field.value!=null){i=s.field.value.data[0].type;break}}}else{if(s.axisTypeField.listBox.selectedItem==s.axisTypeField.listBox.items.getItemAt(1)){if(s.field.value!=null){i=s.field.value.data[0].type;break}}}}if(this.oldType!=i){this.oldType=i;this.field.listBox.items.removeAll();var a=[];if(this.info.labelField!=null){a.push(this.info.labelField)}for(var l=0;l<this.info.dataFields.keys.length;l++){var d=this.info.dataFields.getValue(this.info.dataFields.keys[l]);if(d.isView){a.push(d)}}for(var l=0;l<a.length;l++){var d=a[l];if(this.typeCompatibility(i,d.type)){this.field.listBox.items.addItem(new f.ListBoxItem(d.label,null,[d]))}}if(this.oldField==null){if(this.field.listBox.items.count>0){this.field.listBox.selectedItem=this.field.listBox.items.getItemAt(0);this.oldField=this.field.listBox.selectedItem.data[0].name}}else{var n=true;for(var o=0;o<this.field.listBox.items.count;o++){var r=this.field.listBox.items.getItemAt(o);if(r.data[0].name==this.oldField){this.field.listBox.selectedItem=r;n=false}}if(n){if(this.field.listBox.items.count>0){this.field.listBox.selectedItem=this.field.listBox.items.getItemAt(0);this.oldField=this.field.listBox.selectedItem.data[0].name}}}}this.setLatterFieldList()}this.setFieldListCancel=false};s.prototype.typeCompatibility=function(e,t){if(e==n.DatabaseDataType.Date){return t==n.DatabaseDataType.Date}else if(e==n.DatabaseDataType.Number){return t==n.DatabaseDataType.Number}else{return true}};s.prototype.setLatterFieldList=function(){var e=this.list.getItemIndex(this);for(var t=e+1;t<this.list.count;t++){this.list.getItemAt(t).setFieldList()}};s.isCSSLoaded=false;return s}(i.DisplayObject);t.SeriesEditor=l});